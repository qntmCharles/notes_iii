\documentclass{jknotes}
\usepackage{../joshkirklin}

\tikzset{
    partial ellipse/.style args={#1:#2:#3}{
        insert path={+ (#1:#3) arc (#1:#2:#3)}
    }
}

\setmathfont{Latin Modern Math}
\setmathfont{GFS NeoHellenic Math}[range=bfsfup/{greek,Greek}->it]
\setmathfont{GFS NeoHellenic Math}[range=sfup/{latin,Latin}->it]
\newcommand{\Ra}{\text{Ra}}
\renewcommand{\u}{\symbf{u}}
\newcommand{\veps}{\varepsilon}
\newcommand{\dif}[1]{\left[#1\right]^+_-}
\newcommand{\C}{\mathcal{C}}
\renewcommand{\S}{\mathcal{S}}

\usetikzlibrary{intersections, pgfplots.fillbetween, decorations.pathmorphing}
\tikzset{snake it/.style={decorate, decoration=snake}}
\begin{document}

\institution{Cambridge Part III Maths}
\title{Fluid Dynamics of the Solid Earth}
\lecturer{Dr. Jerome Neufeld}
\notetaker{Charles Powell}
\date{Lent 2020}

\maketitle
\suggestionsspiel
\tableofcontents

\lecture{21/01/21}
\section{Introduction}
The course will use the wealth of observations of the solid Earth to motivate
mathematical models of the physical processes governing its evolution. The
dynamic evolution is governed by a rich variety of physical processes occuring
on a wide range of length and time scales. 

\begin{itemize}
	\item The Earth's core is formed by the solidification of a mixture of
		molten iron and various light elements, a process which drives
		predominantly compositional convection in the liquid outer core, thus
		producing the geodynamo responsible for the Earth's magnetic field. 
	\item On million year timescales, the solid mantle convects, and as it
		upwells to the surface it partially melts leading to volcanism. 
	\item At the surface, convection drives the motion of brittle plates which
		are responsible for the Earth's topography as can be felt and imaged
		through the seismic record (figure~\ref{fig:seismology})
	\item In the Earth's surface, fluids flow through porous rocks, for
		example groundwater aquifers which feed streams and rivers which erode
		the solid surface.
	\item On the Earth's surface, similar physical processes of viscous and
		elastic deformation coupled to phase changes govern the evolution of
		the Earth's cryosphere, from the solidification of sea ice to the flow
		of glacial ice over land and ice shelves over the ocean.
\end{itemize}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{earthquakes.png}
	\caption{Map of global earthquakes, visibly localised to tectonic plate
	boundaries.}
	\label{fig:seismology}
\end{figure}

Predominantly, the mathematics is of slow viscous flows. Topics include the
onset and scaling of convection, the coupling of fluid motions with changes of
phase at a boundary, the thermodynamic and mechanical evolution of
multicomponent or multiphase systems, the coupling of fluid flow and elastic
flexure or deformation, and the flow of fluids through porous materials. 

\section{Plate cooling}
Here we consider a half-space cooling model of the oceanic lithosphere
(oceanic plates). The bottom surface of Earth's oceans, particularly clear in
the Atlantic ocean, has a large scale structure in which the middle of the
ocean (the \emph{mid-ocean ridge}) is shallower than regions closer to the
continents.  The mid-ocean ridge forms as a result of separating tectonic
plates. We know that the plates move apart here due to magnetic anomalies
forming `stripes' of alternating polarity. The quasi-periodic flipping of the
Earth's magnetic polarity allows dating of the stripes. The plates are driven
apart by convection of the Earth's mantle.

\subsection{Thermal  problem}
We wish to form a model describing the depth of the ocean floor near mid-ocean
ridges. First we estimate the temperature field. Consider an idealised model
with a flat surface (for now), observed plate spreading rate $U$, surface
temperature $T_0$, and deep mantle temperature $T_1$.
The temperature field is described by the advection-diffusion equation
\begin{equation}
	\rho c_p \left(\frac{\partial T}{\partial t} + \symbf{u}\cdot\nabla T
	\right) = \nabla \cdot (k \nabla T)
\end{equation}
where $c_p$ is specific heat capacity, $k$ is thermal conductivity, $\rho$ is
density, all assumed constant. For simplicity, we combine these constants into
the thermal diffusivity $\kappa = k/\rho c_p$. Then
\begin{equation}
	\frac{\partial T}{\partial t} + \symbf{u}\cdot\nabla T
	 = \kappa \nabla^2 T
\end{equation}

\begin{figure}
	\begin{center}
	\begin{tikzpicture}
		\draw[->] (-3, 0) -- (3, 0) node[right] {$x$};
		\draw[dashed,->] (-1.5, -2) -- (-1.5, 1) node[above] {$z$};
		\draw[->] (-1, 0.5) -- (0, 0.5) node[right] {$U$};
		\draw[->] (-2, 0.5) -- (-3, 0.5) node[left] {$U$};
		\draw[smooth,blue] plot coordinates {(-1.4, -0.1) (0, -0.3) (3,
		-0.4)};
		\draw[smooth,blue] plot coordinates {(-1.4, -0.2) (0, -0.7) (1.5,
			-1.1) (3, -1.3)};
		\draw[smooth,blue] plot coordinates {(-1.4, -0.3) (0, -1.3) (1.5,
		-2)};
		\draw[blue] (3.5, -1) node {$T(x,t)$ isotherms};
		\draw[blue] (2.5, 0.2) node {$T_0$};
		\draw[blue] (-0.5, -2) node {$T_1$};
	\end{tikzpicture}
	\caption{Schematic diagram of mid-ocean ridge spreading and mantle
	temperature isotherms.}
\end{center}
\end{figure}


We wish to find the steady state profile with $\partial_t = 0, \symbf{u} = U
\hat{\symbf{x}}$ where $U$ is constant. Note that far from the ridge axis, the
thickness of the plate is much smaller than the extent of the plate. Hence in
terms of scalings, $z \ll x$ and we may neglect the $\partial_x^2$ component
of $\nabla^2$. We have
\begin{equation}
	U \frac{\partial T}{\partial x} = \kappa \left( \frac{\partial^2
	T}{\partial x^2} + \frac{\partial^2 T}{\partial z^2}\right) \approx \kappa
	\frac{\partial^2 T}{\partial z^2}
	\label{eq:temp}
\end{equation}
The scaling given by this equation is $U\Delta T / x \sim \kappa \Delta T /
z^2$ where $\Delta T = T_1 - T_0$ is the natural temperature scale. There is
no natural lengthscale, so we use that given by the advection-diffusion
equation:
\begin{equation}
	z \sim \sqrt{\frac{\kappa x}{U}}
\end{equation}

We can proceed by finding a self-similar solution with similarity variable
\begin{equation}
	\eta = \frac{z}{2\sqrt{\frac{\kappa x}{U}}}
\end{equation}
and seek solutions of the form
\begin{equation}
	\theta = \frac{T - T_0}{T_1-T_0} = \theta(\eta)
\end{equation}
Using the variables $\eta, \theta$, \eqref{eq:temp} becomes
\begin{align}
	-U\Delta T \frac{\eta}{2x} \theta_\eta &= \frac{\kappa \Delta T}{4
	\frac{\kappa x}{U}} \theta_{\eta\eta}\\
		\implies \theta_{\eta\eta} + 2\eta\theta_\eta &= 0
\end{align}
We can integrate directly to get $\theta_\eta = ae^{-\eta^2}$, which gives
\begin{equation}
	\theta = b + a \int_0^\eta e^{-y^2} \, \diffd y
\end{equation}
The boundary conditions are $\theta(0) = 1$ and $\theta(\infty) = 1$ based on
the definitions of $T_0$ and $T_1$. The thermal structure away from the ridge
is then
\begin{equation}
	T = T_0 + (T_1-T_0) \erf\left( \frac{z}{2\sqrt{\frac{\kappa x}{U}}}\right)
	\label{eq:T}
\end{equation}
where the error function $\erf$ and its complement erfc are defined by
\begin{align}
	\erf(x) &= \frac{2}{\sqrt{\pi}} \int_0^x e^{-y^2} \, \diffd y \\
	\text{erfc}(x) &= 1 - \erf(x)
\end{align}

\subsection{Ocean depth away from mid-ocean ridge}
We now consider the depth of the ocean following from the temperature field
derived above. We choose axes with $z$ increasing downwards, placing the sea
surface at $z=0$ and the `bottom' of the mantle at $z=H$. The coordinate $x$
increases away from the mid-ocean ridge, with ocean depth $w(x)$ at a given
$x$.

\begin{figure}
	\begin{center}
	\begin{tikzpicture}
		\draw[->] (-1.5, 0.5) -- (-1.5, 0) node[left] {$z$};
		\draw[->] (-1.5, 0.5) -- (-1, 0.5) node[above] {$x$};
		\draw[dashed] (-1.5, 0.5) -- (-1.5, -2);

		\draw[blue,->] (-0.8, 0.1) -- (-0.3, 0.1) node[right] {$U$};
		\draw[blue] (-1.5, 0.5) -- (3, 0.5) node[above] {sea surface};

		\draw[smooth,red] plot coordinates {(-1.4, -0.1) (0, -0.3) (3,
		-0.4)};
		\draw[smooth,red] plot coordinates {(-1.4, -0.2) (0, -0.7) (1.5,
			-1.1) (3, -1.3)};
		\draw[smooth,red] plot coordinates {(-1.4, -0.3) (0, -1.3) (1.5,
		-2)};
		\draw[red] (3.5, -1) node {$T(x,t)$ isotherms};
		\draw[red] (3.25, -0.35) node {$T_0$};
		\draw[red] (-0.5, -2) node {$T_1$};

		\draw[smooth,blue] plot coordinates {(-1.5,0) (0, -0.1) (3, -0.2)};
		\draw[blue] (3, -0.2) node[above] {sea bottom};

		\draw[<->] (0.5, 0.5) -- (0.5, -0.12) node[midway,right] {$w(x)$};
		\draw (-1.4, -2) -- (-1.6, -2) node[left] {$z=H$};
	\end{tikzpicture}
	\caption{Schematic diagram of ocean depth and crust temperature surfaces.}
\end{center}
\end{figure}

First, consider \emph{isostacy}: Archimedean buoyancy applied
to Earth's crust. This indicates the depth at which an object/fluid parcel of some 
density lies in a fluid of different density. 
\begin{center}
	\begin{tikzpicture}[scale=2]
		\draw[blue] (-2, 0) -- (-1, 0); 
		\draw (-1, 0.3) -- (1, 0.3) -- (1, -0.3) -- (-1,
		-0.3) -- (-1, 0.3);
		\draw[blue] (1, 0) -- (2, 0);
		\draw[<->] (0.5, 0.3) -- (0.5, -0.3) node[midway,right] {$h$};
		\draw (-0.5, 0) node {$\rho_c$};
		\draw (-1.5, -0.3) node {$\rho_m$};
		\draw[<->] (1.2, 0) -- (1.2, -0.3) node[midway, right] {$b$};
	\end{tikzpicture}
\end{center}
Denoting the density of the crust and mantle as $\rho_c, \rho_m$ respectively,
the crust of thicknes $h$ sits at a depth $b$ in the mantle. Hydrostatic
balance gives $\rho_c g h = \rho_m g b$. Equivalently, we can consider a force
balance between the weight of the curst and the buoyancy force:
\begin{equation}
	\rho_c (h-b) g = (\rho_m - \rho_c) gb
\end{equation}

Within the oceanic lithosphere we have a denssity field
\begin{equation}
	\rho = \rho_m \left( 1- \alpha (T - T_1)\right)
\end{equation}
where $T=T(x,z)$ is the thermal model derived above, given by \eqref{eq:T}.
Isostatic balance gives the following, which balances water weight and mantle
weight, with water and mantle buoyancy. The ocean density is denoted by
$\rho_w$.

\begin{align}
	\rho_w w_0 + \rho_m (H - w_0) &= \rho_w w(x) + \int_w^H \rho(T) \, \diffd
	z \\
	  &= \rho_w w + \rho_m (H-w) - \rho_m \alpha \int_w^H (T-T_1) \, \diffd z \\
	\implies (\rho_m - \rho_w)(w-w_0) &= - \rho_m \alpha \int_w^H (T-T_1) \,
	\diffd z \\
	&\approx  - \rho_m \alpha (T_1 - T_0) \int_0^\infty \text{erfc}(\eta)
	\cdot 2 \sqrt{\frac{\kappa x}{U}} \, \diffd \eta
\end{align}
where the last approximate equality follows from taking $w \to 0$ and $H \to
\infty$, approximating the fact the mantle is much deeper than the ocean. The
ocean depth is therefore
\begin{equation}
	w-w_0 = \frac{\rho_m}{\rho_m - \rho_w} \alpha (T_1-T_0)
	\frac{2}{\sqrt{\pi}} \left(\frac{\kappa x}{U}\right)^{1/2}
\end{equation}
This model fits the data well near to the mid-ocean ridge, with crust age up
to 75 million years. However, away from the ridge, the model breaks down as
$w$ tends to a constant as $x \to \infty$. The breakdown of the model is due
to convection: the infinite depth mantle approximation breaks down and
convection dynamics become important.

\section{Natural convection}
Natural convection arises in flows driven by density differences in a
gravitational field, e.g. due to temperature or composition.

\subsection{Static stability}
Consider the case of no fluid motion $\symbf{u} = 0$ and initial
stratification $\rho = \rho_0 (1+\beta z)$.  If $\beta < 0$, the dynamics are
statically stable. If $\beta > 0$, the dynamics are statically unstable but
dynamically could be stable. 

\begin{center}
	\begin{tikzpicture}
		\draw[blue] (0,0) -- (2, -3);
		\draw (2, 0) node[right] {light};
		\draw (2, -3) node[right] {heavy};

		\draw[->] (-1, -1) -- (-1, 0) node [midway,left] {$z$};
		\draw (1, -3.5) node {$\beta < 0$};
		\draw (1, 0.5) node {density profile};
		\draw[red] (1, -4) node {statically stable};
		\draw[blue,->] (0, -3) -- (1, -3) node[right] {$\rho$};
	\end{tikzpicture}
	\begin{tikzpicture}
		\draw[blue] (2,0) -- (0, -3);
		\draw (2, -3) node[right] {light};
		\draw (2, 0) node[right] {heavy};

		\draw[->] (-1, -1) -- (-1, 0) node [midway,left] {$z$};
		\draw (1, -3.5) node {$\beta > 0$};
		\draw (1, 0.5) node {density profile};
		\draw[red] (1, -4) node {statically unstable};
		\draw[blue,->] (0, -3) -- (1, -3) node[right] {$\rho$};
	\end{tikzpicture}
\end{center}

\paragraph{Scaling analysis.} Consider a fluid parcel of characteristic size
$l$ in unstable density profile $\rho = \rho_0 (1+\beta z), \beta > 0$.
Suppose the parcel moves up a distance $h$ in time $\tau$.
\begin{center}
	\begin{tikzpicture}
		\draw[blue] (2,0) -- (0, -3);
		\draw (0.7, -3+0.7*3/2) circle (0.2);
		\draw[<->] (1, -2.15) -- (1, -1.75) node[midway,right] {$l$};
		\draw[dashed] (0.7, -1) circle (0.2);
		\draw[<->] (0.3, -3+0.7*3/2) -- (0.3, -1) node[midway,left] {$h$};
		\draw[blue] (2,0) node[right] {$\rho = \rho_0 (1+\beta z)$};
	\end{tikzpicture}
\end{center}

The rise of the fluid parcel relasess potential energy $E$ which scales as
\begin{equation}
	E \sim (\Delta \rho l^3) g h \sim (\rho_0 \beta h l^3) g h \sim \rho_0
	\beta g h^2 l^3
\end{equation}
The timescale for the rising motion is limited by diffusion of buoyancy (i.e.
diffusion of temperature in this case) so $\tau \sim l^2/\kappa$ where
$\kappa$ is thermal diffusivity. Viscous dissipation over timescale $\tau$
scales as the shear stress times the distance travelled:
\begin{equation}
	\mathcal{D} \sim \frac{\mu U}{l}l^2 h \sim \mu \frac{h/\tau}{l} l^2 h \sim
	\frac{\mu \kappa h^2}{l}
\end{equation}

Instability arises if $E \gtrapprox \mathcal{D}$, which we can write as
\begin{equation}
	\rho_0 \beta g h^2 l^3 \gtrapprox \frac{\mu \kappa h^2}{l}
\end{equation}
Define the \emph{Rayleigh number}
\begin{equation}
	\text{Ra} = \frac{\rho_0 \beta g l^4}{\kappa \mu}
\end{equation}
which quantifies the ratio of timescales of thermal transport via diffusion
versus via convection. If $\text{Ra}$ is large, the flow is more turbulent.
There is instability if $\text{Ra} \gtrapprox \mathcal{O}(1)$.

\subsection{Onset of convection}
Consider a fluid of depth $h$ between $z=0$ and $z=h$ with density profile
$\rho(z)$ and temperature difference $\Delta T$ across the depth, where the
$z=0$ surface is warmer.

\begin{center}
	\begin{tikzpicture}[scale=1.2]
		\draw  (0, 2) -- (5, 2);
		\draw (0, 0) -- (5, 0);
		\draw[thick,->] (0, 0) -- (0.5, 0) node[below] {$x$};
		\draw[thick,->] (0, 0) -- (0, 0.5) node[left] {$z$};
		\draw (5, 0.2) node {$z=0$};
		\draw (5, 2.2) node {$z=h$};
		\draw[red] (0.5, 2) -- (1, 0) node[midway,right] {$T(z)$};
		\draw[red] (0.5, 2) node[above] {$T_0$};
		\draw[red] (1.25, 0) node[below] {$T_0 + \Delta T$};
		\draw[blue] (3.5,0) -- (4, 2) node[midway,right] {$\rho(z)$};
	\end{tikzpicture}
\end{center}

The governing equations are conservation of mass \eqref{eq:masscons},
conservation of momentum \eqref{eq:momcons}, and conservation of (thermal)
energy \eqref{eq:energycons}.
\begin{align}
	\nabla \cdot \symbf{u} &= 0 \label{eq:masscons} \\
	\rho \left( \frac{\partial \symbf{u}}{\partial t} +
	\symbf{u}\cdot\nabla\symbf{u}\right) &= - \nabla p + \mu \nabla^2
	\symbf{u} - \rho g \hat{\symbf{z}} \label{eq:momcons} \\
	\rho c_p \left( \frac{\partial T}{\partial t} + \symbf{u} \cdot \nabla T
	\right) &= \nabla \cdot (k \nabla T) \label{eq:energycons}
\end{align}

For steady solutions with $\symbf{u} = 0$ and $\partial_t = 0$ we find
\begin{align}
	T &= T_0 + \Delta T \left(1-\frac{z}{h}\right) \\
	\frac{\partial p}{\partial x} = \frac{\partial p}{\partial y} &= 0 \\
	\frac{\partial p}{\partial z} &= - \rho_0 g \left( 1- \alpha
	(T-T_0)\right) 
\end{align}
We assess the stability by examining small perturbations to a steady base
state:
\begin{align}
	\symbf{u} &= 0 + \symbf{u}'(\symbf{x},t) \\
	T &= T_0 + \Delta T \left(1-\frac{z}{h}\right) + T'(\symbf{x},t) \\
	p &= p_0(z) + p'(\symbf{x},t) 
\end{align}
The linearised perturbation equations are thus
\begin{align}
	\nabla \cdot \symbf{u}' &= 0  \\
	\rho_0  \frac{\partial \symbf{u}'}{\partial t} &= - \nabla p' + \mu
	\nabla^2 \symbf{u}' + \rho_0 g \alpha T' \hat{\symbf{z}} \\
	\frac{\partial T'}{\partial t} - \frac{\Delta T}{h} w' &= \kappa \nabla^2
	T'
\end{align}

\paragraph{Non-dimensionalising.}
We wish to non-dimensionalise these equations. There are two intrinsic
scales, temperature $\sim \Delta T$ and lengths $\sim h$. We form velocity and
time characteristic scales via \emph{diffusive scaling}. From the thermal
equation:
\begin{equation}
	\frac{\Delta T}{t} \sim \frac{\Delta T U}{h} \sim \frac{\kappa \Delta
	T}{h^2}
\end{equation}
From the second relation we have $U \sim \kappa/h$, then from the first we
have $t \sim h^2/\kappa$.  The non-dimensionalised equations (dropping $'$
henceforth) are
\begin{align}
	\nabla \cdot \symbf{u} &= 0 \label{eq:L2:1}\\
	\frac{1}{\text{Pr}} \frac{\partial \symbf{u}}{\partial t} &= - \nabla p +
	\nabla^2 \symbf{u} + \text{Ra}T \hat{\symbf{z}} \label{eq:L2:2}\\
	\frac{\partial T}{\partial  t} - w &= \nabla^2 T  \label{eq:L2:3}
\end{align}
where the \emph{Prandtl number} is defined as $\text{Pr} =
\frac{\mu/\rho_0}{\kappa}$ which quantifies the importance of viscous
diffusion versus thermal diffusion.

\paragraph{Boundary conditions.} We require boundary conditions on the
temperature $T$ and velocity $\symbf{u}$. There are several possible
conditions, which may be mixed:
\begin{itemize}
	\item Rigid boundary $\left[ \symbf{u}\cdot\hat{\symbf{n}}
		\right]_{\text{boundary}} = 0$ where $\hat{\symbf{n}}$ is outwards
		normal of boundary surface
	\item	No-slip $\left[ \symbf{u}\times\hat{\symbf{n}}
		\right]_{\text{boundary}} = 0$
	\item Stress-free (free slip) $\mu\frac{\partial u}{\partial n} = \mu
		\frac{\partial v}{\partial n} = 0$ i.e. $n=z$ in our picture
	\item Fixed temperature $T_{\text{boundary}} = \text{const.}$
	\item Fixed heat flux $\left[ \hat{\symbf{n}}\cdot\nabla
				T\right]_{\text{boundary}} = \text{const.}$
\end{itemize}

We eliminate pressure from the non-dimensionalised equations by taking
$\hat{\symbf{z}}\cdot\nabla \times (\nabla \times \eqref{eq:L2:2})$. Recall the
vector identity
\begin{equation}
	\nabla \times (\nabla \times \symbf{A}) = \nabla (\nabla \cdot \symbf{A})
	- \nabla^2 \symbf{A}
\end{equation}
The governing equations are reduced to
\begin{align}
	\left( \text{Pr}^{-1} \partial_t - \nabla^2 \right) \nabla^2 w &=
	\text{Ra} \nabla^2_H T \label{eq:L2:4}\\
	\left( \partial_t - \nabla^2 \right) T &= w \label{eq:L2:5}
\end{align}
where $\nabla_H = (\partial_x, \partial_y, 0)$ is the horizontal gradient.

\paragraph{Normal modes.} We examine growth/decay of perturbations of the form
\begin{equation}
	(w,T) = (\hat{w}(z),\hat{T}(z))e^{i(kx+ly)+\sigma t}
\end{equation}
For convenience, and given the $x, y$ symmetry, define $a^2 = k^2 + l^2$ as an
effective horizontal wavenumber. We have from the governing equations
\eqref{eq:L2:4}, \eqref{eq:L2:5}:
\begin{align}
	\left[\sigma \text{Pr}^{-1} - (D^2 - a^2)\right](D^2-a^2) &= -\text{Ra}
	a^2 \hat{T} \label{eq:L2:6}\\
	\left[ \sigma - (D^2 - a^2) \right] \hat{T} &= \hat{w} \label{eq:L2:7}
\end{align}
where $D = \diffd/\diffd z$. The boundary in our case will be
rigid, stress free, and fixed temperature. Note that this is not necessarily
representative of the actual boundary conditions, but is useful analytically.
Thus at $z= 0, 1$ we have $w = 0$ (rigid), $D^2 w = 0$ (stress free) and $T=
0 $ (fixed temperature). Given these conditions, the heat equation implies
$D^2 T = 0$ on $z=0,1$ and the momentum equation implies $D^4 w = 0$ on
$z=0,1$. 

\paragraph{Marginal stability.} The marginal stability boundary is $\sigma =
0$ between growth ($\sigma > 0$) and decay ($\sigma < 0$). Combining
\eqref{eq:L2:6} and \eqref{eq:L2:7} with $\sigma = 0$ we have
\begin{equation}
 (D^2 - a^2)^3 (\hat{T},\hat{w}) = -a^2 \text{Ra}(\hat{T},\hat{w})
\end{equation}
The solutions have structure 
\begin{equation}
 (\hat{T}, \hat{w}) =  (\hat{T}_0, \hat{w}_0) \sin n \pi z
\end{equation}
Hence we have the eigenvalue condition $(n^2 \pi^2 + a^2)^3 = a^2 \text{Ra}$.
Let $a^2 = \pi^2 b^2$. Then
\begin{equation}
 \text{Ra} = \frac{(n^2 + b^2)^3 \pi^4}{b^2}
\end{equation}

The minimum Rayleigh number is at $n=1$ where $\text{Ra} = (1+b^2)^3
\pi^4/b^2$:
\begin{center}
 \begin{tikzpicture}[scale=1.6]
	 \draw[thick,->] (-0.1, 0) -- (5, 0) node[right] {$b^2$};
	 \draw[thick,->] (0, -0.1) -- (0, 3) node[left] {Ra};
	 \draw[smooth,blue] plot[domain=0.035:3.89,samples=100]  ({\x},{(1+\x)^3/(10*\x)});
	 \draw (0.5,0.1) -- (0.5, -0.1) node[below] {$1/2$};
	 \draw (0.1, 0.675) -- (-0.1, 0.675) node[left]
	 {$\text{Ra}_{\text{crit}}$};
	\draw (0.5, 2) node {$\sim \frac{\pi^4}{b^2}$};
	\draw (3, 1.5) node {$\sim \pi^4 b^4$};
	\draw[blue] (3.8, 2.5) node {$\sigma = 0$};
	\draw[red] (1.5, 0.5) node {stable $\sigma < 0$};
	\draw[red] (1.5, 2.5) node {unstable $\sigma > 0$};
 \end{tikzpicture}
\end{center}

Setting $\partial \text{Ra}/\partial b^2 = 0$ to find the critical Rayleigh
number $\text{Ra}_{\text{crit}}$, we find
\begin{equation}
 \text{Ra}_{\text{crit}} = \frac{27 \pi^4}{4} \approx 657.5 \hspace{2em}
 \text{at}\,\,\, a = \frac{\pi}{\sqrt{2}}
\end{equation}
Hence the dimensional wavelength at critical Rayleigh number is $2\pi h/a =
2\sqrt{2} h \approx 2.8 h$. The convection process appears like so:
\begin{center}
	\begin{tikzpicture}
		\draw (0, 2.5) node {side view};
		\draw[thick] (0,0) -- (5, 0) node[right] {$z=0$};
		\draw[thick] (0,2) -- (5, 2) node[right] {$z=h$};
		\draw[red,->] (2.3, 1) arc(0:360:0.9);
		\draw[red,<-] (2.7, 1) arc(-180:180:0.9);
		\draw[red,->] (2.0, 1) arc(0:360:0.6);
		\draw[red,<-] (3.0, 1) arc(-180:180:0.6);
	\begin{scope}[shift={(0,-3)}]
		\draw (0, 2.5) node {top view};
		\draw[thick] (0,0) -- (5, 0);
		\draw[thick] (0,2) -- (5, 2);
		\draw[dashed] (1, 2) -- (1, 0) node[below] {down};
		\draw[dashed] (4, 2) -- (4, 0) node[below] {up};
		\draw[dashed] (2.5, 2) -- (2.5, 0) node[below] {down};
		\draw[red,->] (2.6, 0.6) -- (3.9, 0.6);
		\draw[red,->] (2.6, 1.4) -- (3.9, 1.4);
		\draw[red,->] (2.4, 0.6) -- (1.1, 0.6);
		\draw[red,->] (2.4, 1.4) -- (1.1, 1.4);
		\draw[red,->] (-0.4, 0.6) -- (0.9, 0.6);
		\draw[red,->] (-0.4, 1.4) -- (0.9, 1.4);
		\draw[red,->] (5.4, 0.6) -- (4.1, 0.6);
		\draw[red,->] (5.4, 1.4) -- (4.1, 1.4);
	\end{scope}
	\end{tikzpicture}
\end{center}

\begin{eg}
	\textbf{Mantle convection.} In the mantle, internal heating is due to
	radiogenic decay. We model this by adding a source term to the conservation of
	energy equation:
	\begin{equation}
		\rho_0 c_p \left( \frac{\partial T}{\partial t} + \symbf{u}\cdot\nabla
		T\right) = \nabla \cdot (k\nabla T) + \rho_0 Q
	\end{equation}
	where $Q = 10^{11} \text{W} \text{kg}^{-1}$. The thermal boundary conditions
	are $T(0) = T_s$, i.e. fixed surface temperature, and $\partial T / \partial
	z = 0$ at $z=h$, i.e. zero basal heat flux.

	A scaling analysis gives 
	\begin{equation}
		x \sim h, \frac{k \Delta T}{h^2} \sim \rho_0 Q
		\implies \Delta T \sim \frac{\rho_0 Q h^2}{k}
	\end{equation}
	The Rayleigh number in this case is
	\begin{equation}
		\text{Ra}_Q = \frac{\rho_0 g \alpha (\rho_0 Q h^2 / k) h^3}{\kappa \mu} =
		\frac{\rho_0^2 g \alpha Q h^5}{k \kappa \mu}
	\end{equation}
	Typical values are $\text{Ra}_Q = 3 \times 10^9$ and $\text{Pr} = 10^{22}$.
	Note that $\text{Ra}_Q$ is much larger than $\text{Ra}_{\text{crit}}$.
\end{eg}

\subsection{High Rayleigh number convection}
At high Rayleigh number, the key idea is: small plumes are generated at
boundaries, which only `see' the statistically well-mixed interior
temperature. Hence heat flux is independent of depth of domain.
\begin{center}
	\begin{tikzpicture}
		\draw[thick] (0,0) -- (5, 0);
		\draw[thick] (0, 2) -- (5, 2);
		\draw[dashed] (0, 0.2) -- (5, 0.2);
		\draw[dashed] (0, 1.8) -- (5, 1.8);
		\draw (0.5, 2) node[above] {$T_0$};
		\draw[red] (0.5, 2) -- (1, 1.8);
		\draw[red] (1, 1.8) -- (1.2, 0.2) node[midway,right]
		{$\overline{T}(z)$};
		\draw[red] (1.2, 0.2) -- (1.7, 0) node[below] {$T_0 + \Delta T$};
		\draw[->] (0.2, 1) arc (0:350:0.2);
		\draw[->] (0.6, 1) arc (180:-170:0.2);
		\draw[->] (3.2, 1) arc (0:350:0.2);
		\draw[->] (3.6, 1) arc (180:-170:0.2);
		\draw (7, 1.2) node {viscous \& thermal};
		\draw (7, 0.8) node {boundary layers};
		\draw[->] (5.4, 1.2) -- (5.2, 1.8);
		\draw[->] (5.4, 0.8) -- (5.2, 0.2);
		\draw (-1.5, 1.2) node {well mixed};
		\draw (-1.5, 0.8) node {interior};
	\end{tikzpicture}
\end{center}

The heat flux is characterised by the \emph{Nusselt number} defined by
\begin{equation}
	\text{Nu} = \frac{F_h}{k \Delta T/h} = f(\text{Ra},\text{Pr})
\end{equation}
where $F_h$ is the heat flux, and $\text{Nu}$ is a function of $\text{Ra},
\text{Pr}$ only. If $F_h$ is not a function of $h$, then we must
have
\begin{align}
	F_h = \frac{k \Delta T}{h} f(\text{Ra},\text{Pr}) &\sim \frac{k \Delta
	T}{h} \text{Ra}^{1/3} \\
	\implies F_h &= \lambda(\text{Pr})k \left( \frac{\rho_0 g
	\alpha}{K\mu}\right)^{1/3} \Delta T^{4/3}
\end{align}
for some function $\lambda$.

\paragraph{Boundary layer analysis.}
The picture was formalised by Lou Howard (1965). We assume the thermal
boundary layer grows diffusively (i.e. slowly) according to
\begin{equation}
	\frac{\partial T}{\partial t} = \kappa \frac{\partial^2 T}{\partial z^2} 
\end{equation}
\begin{center}
	\begin{tikzpicture}
		\draw (0,0) -- (5, 0);
		\draw[dashed] (0,1) -- (5,1);
		\draw[<->] (-0.1, 1) -- (-0.1, 0) node[midway,left] {$\delta(t)$};
		\draw[smooth, red] plot coordinates {(2, 3) (2.1, 1) (3, 0)};
		\draw[red] (3, 3) node {$T_0 + \Delta T /2$};
		\draw (3, 2.5) node {interior};
		\draw (4, 0.5) node {thermal BL};
		\draw[red] (3,0) node[below] {$T_0 + \Delta T$};
	\end{tikzpicture}
\end{center}

Diffusive scaling gives $z \sim \sqrt{\kappa t}$, i.e. a self-similar solution
with similarity variable $\eta = z/2\sqrt{\kappa t}$. The thermal problem can
be solved to get
\begin{equation}
	T = T_0 + \frac{\Delta T}{2}\left[ 1 + \text{erfc}(\frac{z}{2\sqrt{\kappa
	t}})\right]
\end{equation}

The boundary layer is unstable when the local Rayleigh number exceeds the
critical value.
\begin{align}
	\Ra_{BL} = \frac{\rho_0 g \alpha (\Delta T/2) \delta(t)^3}{\kappa \mu}
	&\gtrapprox \Ra_{\text{crit}} \\
	\implies \frac{\delta}{h} &\gtrapprox \left( \frac{2
	\Ra_c}{\Ra}\right)^{1/3}
\end{align}

Assume that advection of plumes from the boundary layer is fast compared with
diffusive growth of the boundary layer. The heat flux is
\begin{equation}
	F_h = \frac{k \Delta T}{2t_c} \int_0^{t_c} \frac{\diffd t}{\sqrt{\pi\kappa
	t}} = \frac{k\Delta T}{\delta_c}
\end{equation}
Hence the Nusselt number can be written
\begin{equation}
	\text{Nu} = \frac{F_h}{k\Delta T/h} = \frac{h}{\delta_c} = \left(
	\frac{\Ra}{2\Ra_c}\right)^{1/3}
\end{equation}
For $\Ra_{\text{crit}} \approx 1100$, the Nusselt number is thus $\text{Nu}
\approx 0.077 \Ra^{1/3}$ which matches well with experiment.

\section{Solidification/melting}.
Applications of solidification/melting theory include
\begin{itemize}
	\item Formation of Earth's crust (early 1800s)
	\item Sea ice, due to Stefan (late 1800s)
	\item Earth's core (mid 1950s)
	\item Igneous rocks (mid 1980s)
\end{itemize}

\subsection{The Stefan condition}
Consider a solid--liquid interface $x = a(t)$ with boundary velocity $v_n$. We
will work in the frame of reference moving with the boundary.
\begin{center}
	\begin{tikzpicture}
		\draw[thick] (0,0) -- (0, 5);
		\draw (2, 1) -- (2, 4) -- (-2, 4) -- (-2, 1) -- (2,1);
		\draw (0,0) node[below] {$x=0$};
		\draw[thick,->] (0, 4.5) -- (1, 4.5) node[right] {$\hat{\symbf{n}}$};
		\draw[->] (2.5, 0.5) -- (1.5, 0.5) node[midway,below] {$v_n$};
		\draw[<-] (-2.5, 0.5) -- (-1.5, 0.5) node[midway,below] {$v_n$};
		\draw[<-] (2.5, 2.5) -- (0.5, 2.5) node[midway,below]
		{$\symbf{q}_l$};
		\draw[->] (-2.5, 2.5) -- (-0.5, 2.5) node[midway,below]
		{$\symbf{q}_s$};
	\end{tikzpicture}
\end{center}

We assume there is a heat flux $\symbf{q}_s$ into the control volume, and a
heat flux $\symbf{q}_l$ leaving the control volume. Assume equal densities for
the liquid and solid, i.e. $\rho_l = \rho_s = \rho$. Conservation of energy in
the control volume gives:
\begin{equation}
	\rho H_l v_n - \hat{\symbf{n}}\cdot\symbf{q}_l - \rho H_s v_n +
	\hat{\symbf{n}} \cdot \symbf{q}_s = 0
\end{equation}
where $\symbf{q} = - k \nabla T$ and $H$ is the \emph{specific enthalpy},
which is the heat energy at constant pressure per unit mass. Rearranging, we
have
\begin{equation}
	\rho (H_l - H_s)v_n = \hat{\symbf{n}}\cdot (\symbf{q}_l - \symbf{q}_s)
\end{equation}
Define $L = H_l - H_s = T_m (s_s - s_l)$ where $T_m$ is the melting
temperature and $s$ is the entropy of solid/liquid. $L$ is the latent heat of
fusion/solidification. At the boundary $x=a(t)$ we have
\begin{equation}
	\rho L v_n = k \hat{\symbf{n}} \cdot (\left.\nabla T \,\right|_s -
	\left.\nabla T \,\right|_l)
\end{equation}
where all quantities are evaluated at the boundary. This is the \emph{Stefan
condition}.

Note that if $\rho_s \ne \rho_l$ there is a velocity $u_n$ induced at the
interface:
\begin{equation}
	u_n = \frac{\rho_l - \rho_s}{\rho_l} v_n
\end{equation}
in which case the Stefan condition is modified to
\begin{equation}
	\rho_s L v_n = k_s \hat{\symbf{n}} \cdot \left.\nabla T \,\right|_s - k_l
	\hat{\symbf{n}} \cdot \left.\nabla T \,\right|_l
\end{equation}

\subsection{1D solification from a cooled boundary}
For convenience we again assume equal densities and thermal properties. 
\begin{center}
	\begin{tikzpicture}
		\draw[thick] (0,0) -- (0, 3);
		\draw[draw=none,fill=gray!50] (0,0) rectangle (-0.5, 3);
		\draw[smooth,red] plot coordinates {(0, 1) (0.8, 1.9) (2, 2)};
		\draw[red] (0, 1) node[left] {$T_B$};
		\draw[red] (2, 2) node[right] {$T_m$};
		\draw (0.8, 0) -- (0.8, 3);
		\draw (0.4, 3) node[above] {solid};
		\draw (2, 3) node[above] {liquid};
		\draw (0.8, 0) node[below] {$x=a(t)$};
	\end{tikzpicture}
\end{center}

In the solid, the temperature $T$ obeys
\begin{equation}
	\frac{\partial T}{\partial t} = \kappa \frac{\partial^2 T}{\partial x^2}
\end{equation}
with boundary conditions $T = T_B$ at $x=0$ and $T = T_m$ at $x= a(t)$. We
also have the Stefan condition
\begin{equation}
	\rho L \dot{a} = k \left.\frac{\partial T}{\partial x} \right|_{a^-}
\end{equation}
at $x = a(t)$.  Scaling from the thermal equation gives $x \sim \sqrt{\kappa
t}$ as usual.  From Stefan's condition we have
\begin{equation}
	\rho L \frac{x}{t} \sim k \frac{\Delta T}{x} = \rho c_p \kappa
	\frac{\Delta T}{x}
\end{equation}
which yields $x \sim \sqrt{\kappa t \frac{c_p \Delta T}{L}}$. The factor in
the square root is dimensionless, hence we have $x \sim \sqrt{\kappa t}$ in
agreement with the thermal equation. We use similarity variable $\eta = x /
2\sqrt{\kappa t}$ and define $\theta(\eta)$ via
\begin{equation}
	T - T_B = (T_m - T_B) \theta(\eta)
\end{equation}

Now $a(t) = 2 \lambda \sqrt{\kappa t}$, thus the diffusion equation becomes
\begin{equation}
	-2\eta \theta' = \theta''
\end{equation}
with $0 \le \theta \le \lambda$. The boundary conditions are now $\theta(0) =
0, \theta(1) = \lambda$ and 
\begin{equation}
	2 \mathcal{S} \lambda = \theta'(\lambda)
\end{equation}
where $\mathcal{S} = L/c_p \Delta T$ is the Stefan number. The solution is
\begin{equation}
	\theta = \frac{\erf \eta}{\erf \lambda}
\end{equation}
where $\lambda$ satisfies
\begin{equation}
	\sqrt{\pi} \lambda e^{\lambda^2} \erf \lambda = \frac{1}{\mathcal{S}}
\end{equation}
\begin{center}
	\begin{tikzpicture}[scale=2]
		\draw[blue, smooth] plot coordinates {(0,0) (0.2, 0.0464) (0.4,
		0.2011) (0.6, 0.5193) (0.8, 1.1259)};
		\draw[thick,->] (-0.1,0) -- (1, 0) node[right] {$\lambda$};
		\draw[thick,->] (0,-0.1) -- (0, 1.2) node[above] {$1/\mathcal{S}$};
		\draw (0.8, 0.3) node {$\sim \lambda^2$};
	\end{tikzpicture}
\end{center}
Large $\mathcal{S}$ implies small $\lambda$, i.e. small growth, and vice
versa. Note for water, $L/c_p \approx 80^{\circ}$C.

\subsubsection{Quasi-steady approximation}
When $\mathcal{S} \gg 1$ the Stefan condition implies growth is slow. Rescale
time $t \to \mathcal{S} t$ so the time derivative becomes
$\mathcal{O}(\mathcal{S}^{-1})$. Then
\begin{equation}
	\frac{\partial^2 T}{\partial x^2} \approx 0 \implies \frac{\partial
	T}{\partial x} = \frac{T_m - T_B}{a}
\end{equation}
i.e. there is a linear conduction profile in the solid. The Stefan condition
is now
\begin{equation}
	\rho L \dot{a} = k \left.\frac{\partial T}{\partial x} \right|_a \approx
	\frac{k(T_m - T_B)}{a}
\end{equation}
where $a = \sqrt{2\kappa t / \mathcal{S}}$. This definition of $a$ follows
from: $\mathcal{S} \gg 1 \implies \lambda \ll 1$. Then
\begin{equation}
	\sqrt{\pi} \lambda e^{\lambda^2} \erf \lambda = \frac{1}{\mathcal{S}}
	\approx \sqrt{\pi} \lambda \cdot 1 \cdot \frac{2}{\sqrt{\pi}} \lambda
\end{equation}
Hence $\lambda \sim (1/2\mathcal{S})^{1/2}$, from which $a(t) = 2\lambda
\sqrt{\kappa t}$ gives $a$ as above.

Note: as $t \to 0$, $\dot{a} \sim t^{-1/2} \to \infty$. This is physically
implausible; in fact growth is regularised by crystal kinetics which is not
included in this model.

\subsection{Phase change and fluid flow}
Consider 2D stagnation point flow driving a steady melting of a solid, with
fluid velocity
\begin{equation}
	\symbf{u} = (Ex, -Ez)
\end{equation}
\begin{center}
	\begin{tikzpicture}
		\draw[draw=none,fill=gray!20] (0,0) rectangle (5, -1);
		\draw (0,0) -- (5,0) node[right] {$z=0$};
		\draw (5.5, 2.5) node {liquid};
		\draw (5.5, -1) node {solid};
		\draw[dashed] (2.5, 0) -- (2.5, 3);
		\draw[thick,->] (2.5,0) -- (3, 0) node[below] {$x$};
		\draw[thick,->] (2.5, 0) -- (2.5, 0.5) node[right] {$z$};
		\draw[thick,->] (1, 0.5) -- (1, -0.5) node[left] {$v$};
		\draw[red] (-0.5, 0) node {$T=T_m$};
		\draw[red] (-0.5, 2) node {$T_{\infty} > T_m$};
		\draw[blue,<-,smooth] plot[domain=0:2.167] ({\x},{-1/(\x-2.5)});
		\draw[blue,->,smooth] plot[domain=2.833:5] ({\x},{1/(\x-2.5)});
		\draw[blue,<-,smooth] plot[domain=0:1.5] ({\x},{-3/(\x-2.5)});
		\draw[blue,->,smooth] plot[domain=3.5:5] ({\x},{3/(\x-2.5)});
	\end{tikzpicture}
\end{center}

Steady-state in a translating frame of reference (i.e. moving with boundary at
speed $v$) implies $T = T(z)$ is a function of $z$ only. In steady-state are
left with a balance of advection and diffusion:
\begin{equation}
	(v-Ez)\frac{\partial T}{\partial z} = \kappa \frac{\partial^2 T}{\partial
	z^2}
\end{equation}
where $v$ is the melt rate. Neglecting advection by the frame (justify later)
we have solution
\begin{equation}
	T = T_m + (T_{\infty} - T_m) \erf \left( \sqrt{\frac{E}{2\kappa}} z \right)
\end{equation}
The Stefan condition gives
\begin{equation}
	-\rho L v = - k\left.\frac{\partial T}{\partial z} \right|_{z=0} = -k
	\frac{2}{\sqrt{\pi}} (T_\infty - T_m) \sqrt{\frac{E}{2\kappa}}
\end{equation}
Hence the melt rate can be written as
\begin{equation}
	v = \frac{1}{\mathcal{S}} \sqrt{\frac{2E \kappa}{\pi}}
\end{equation}

Note the following:
\begin{itemize}
	\item The melt rate $v$ increases as flow rate $E$ increases ($v \sim
		\sqrt{E}$)
	\item The thermal boundary layer has scale $\delta_T \sim \sqrt{\kappa/E}$.
		Thus $\delta_T$ decreases as $E$ increases, i.e. the flow compresses
		the thermal boundary layer
	\item The ratio of frame advection to flow compression is
		\begin{equation}
			\frac{\text{advection}}{\text{compression}} \sim \frac{v}{Ez} \sim
			\frac{v}{E\delta T} \sim \frac{v}{\sqrt{E\kappa}} \sim
			\frac{1}{\mathcal{S}}
		\end{equation}
		So neglect of frame advection is valid if $\mathcal{S} \gg 1$.
\end{itemize}

\subsection{Solidification with vigorous convection}
Consider solidification of a liquid with vigorous convection, so that there is
a well-mixed interior temperature $\overline{T}(t)$ in the liquid.
\begin{center}
	\begin{tikzpicture}
		\draw[draw=none,fill=gray!20] (0,0) rectangle (5, 1);
		\draw (0,0) -- (5, 0) node[right] {$z=a(t)$};
		\draw[dashed, blue] (0,-0.5) -- (5, -0.5);
		\draw[->] (1, 0.5) -- (1, 0);
		\draw[->] (1, -1) -- (1, -0.5);
		\draw (0, -0.25) node {thermal BL};
		\draw[fill=red,draw=none] (3, 0) circle (0.05);
		\draw[red] (3.15,0) node[above] {$T_m$};
		\draw[red] (3,0) -- (2.5, 1);
		\draw[red] (3.3, -0.55) -- (3.3, -2) node[right] {$\overline{T}(t)$};
		\draw[red,->] (1, -1.5) arc(0:300:0.2);
		\draw[red,->] (1.5, -1.7) arc (160:-140:0.2);
		\draw[red,->] (3.75, -0.7) arc (140:-160:0.2);
		\draw[red,->] (4.5, -1) arc (30:320:0.2);
	\end{tikzpicture}
\end{center}

Recall from earlier sections that high Rayleigh number convection has heat
flux
\begin{equation}
	F_T = \lambda k \left( \frac{\rho_0 g \alpha}{\kappa \mu}\right)^{1/3}
	\left( \overline{T} - T_m\right)^{4/3}
\end{equation}
Consider a control volume around the solid--liquid interface \emph{and} the
thermal boundary layer, and impose energy conservation. Note that the control
volume is in a frame of reference moving at the melt rate $v$ with the
interface.
\begin{center}
	\begin{tikzpicture}
		\draw[draw=none,fill=gray!20] (0,0) rectangle (5, 1);
		\draw (0,0) -- (5, 0) node[right] {$z=a(t)$};
		\draw[dashed, blue] (0,-0.5) -- (5, -0.5);
		\draw[->] (0.3, 0.5) -- (0.3, 0);
		\draw[->] (0.3, -1) -- (0.3, -0.5);
		\draw (0, -0.25) node {$\delta_T$};
		\draw[fill=red,draw=none] (3, 0) circle (0.05);
		\draw[red] (3.15,0) node[above] {$T_m$};
		\draw[red] (3,0) -- (2.5, 1);
		\draw[red] (3.3, -0.55) -- (3.3, -2) node[right] {$\overline{T}(t)$};
		\draw[dashed] (1.5, 0.7) -- (4.5, 0.7) -- (4.5, -1) -- (1.5, -1) -- (1.5,
		0.7);
		\draw[->] (2, -1.75) -- (2, -0.75) node[midway,right] {$F_T$};
		\draw[->] (3.7, -1.75) -- (3.7, -0.75) node[midway,right] {$v$};
		\draw[->] (3.7, 0.4) -- (3.7, 1.4) node[midway,right] {$v$};
	\end{tikzpicture}
\end{center}

Conservation of energy with melt rate $v$ gives
\begin{equation}
	\rho (H_l - H_s)v + \rho c_p (\overline{T}-T_m)v + F_T - k \left.\frac{\partial
	T}{\partial z}\right|_{a^-} = 0
\end{equation}
Rearranging, we have
\begin{equation}
	\rho \left[ L + c_p(\overline{T}-T_m)\right] v = k \left.\frac{\partial
	T}{\partial z}\right|_{a^-} - F_T
\end{equation}
The first term is the release of latent heat, the second is cooling across the
boundary layer, the third is conduction in the solid and the final term is the
convective heat flux. This is the modified Stefan condition (needed for ES1
Q4).

\subsection{Earth's core}
Consider solidification of the Earth's inner core, driven by heat flux $F_m$
from the mantle. 

\begin{center}
	\begin{tikzpicture}
		\draw[fill=black] (0,0) circle (0.05);
		\draw[fill=red!20] (0,0) circle (2.2);
		\draw[fill=gray!50] (0,0) circle (1);
		\draw (0,0) -- (1.32,1.76) node[midway,right] {$R_o$};
		\draw (0,0) -- (0.88,0.475) node[midway,below] {$R_i$};
		\draw[red,thick,->] (1.5, 2) --++ (0.75,1) node[midway,right] {$F_m$};
		\draw (0, 1.5) node {\tiny outer core, liquid};
		\draw (0, -1.2) node {\tiny inner core, solid};
		\draw[->] (0, -1.1) -- (0, -0.5);
		\draw (2.2, 1.8) node {\tiny mantle};
	\end{tikzpicture}
\end{center}

We require a relation between the melt temperature $T_m = T_m(p)$ and the
pressure $p$, which is provided by the \emph{Clausius-Clapeyron equation}:
\begin{equation}
	\rho_s \frac{L}{T_m} \frac{\partial T_m}{\partial p} =
	\frac{\rho_s}{\rho_l} - 1
\end{equation}
The RHS quantity is positive for iron in the inner core.  Given a temperature
profile $T_m$ and a fixed boundary temperature, this equation gives the radius
at which that boundary temperature is met, given a pressure profile $p(r)$.
To leading order, the pressure is hydrostatic
\begin{align}
	\frac{\partial p}{\partial r} = - \rho g(r) &= - \rho \frac{G}{r^2} \left(
	\frac{4\pi}{3} r^3 \rho\right) = - \frac{4\pi}{3}G \rho^2 r \\
\implies p &= p_0 - \frac{2\pi}{3} G \rho^2 r^2
\end{align}
Substituting this form of the pressure into the Clausius-Clapeyron equation
gives
\begin{equation}
	T_m \approx T_0 - \frac{2\pi}{3} \frac{G T_0 (\rho_s - \rho_l)}{L} r^2
\end{equation}

The radius at which the (adiabatic) core temperature $T$ is equal to $T_m$ is
where the solid--liquid interface exists, i.e. at $r=R_i$.
\begin{center}
	\begin{tikzpicture}[scale=3];
		\draw[thick,->] (-0.1, 0) -- (2.5, 0) node[right] {$r$};
		\draw[thick,->] (0, -0.1) -- (0, 1);
		\draw[red] plot[domain=0:2] ({\x},{1+1/(\x-3)});
		\draw[blue] plot[domain=0:1.667] ({\x},{1.2+1/(\x-2.5)});
		\draw[blue] (0,0.8) node[left] {$T_m$};
		\draw[red] (0,0.667) node[left] {$T$};
		\draw[dashed] (1.149,0.4597) -- (1.149, 0) node[below] {$R_i$};
	\end{tikzpicture}
\end{center}
Note we separately assume a well mixed adiabatic temperature profile in the
outer core
$\overline{T} = T_m$.

Consider the two choices of limiting cases:
\begin{enumerate}
	\item No heat flux from inner core
	\item Perfectly conducting inner core $T_{IC} = T_m$. Outer core is
		convecting vigorously so assume well mixed, $T$ is adiabatic, i.e.
		`potential temperature' is isothermal.
\end{enumerate}

The balance of heat fluxes is
\begin{equation}
	4\pi R_0^2 F_m = \frac{4\pi}{3}\left[ R_0^3 - R_i^3\right] \rho c_p
	\frac{\partial T_m}{\partial t} + \rho L 4\pi R_i^2 \frac{\diffd
	R_i}{\diffd t}
\end{equation}
In case 2 the $R_i^3$ term in the first RHS term is neglected. In this
case,
\begin{equation}
	4\pi R_0^2 F_m = \frac{4\pi}{3} R_0^3 \rho c_p \cdot \frac{4\pi}{3}
	\frac{G T_m \delta \rho}{L} R_i \dot{R}_i + \rho L4\pi R_i^2 \dot{R}_i
\end{equation}
Hence the time averaged mantle heat flux is
\begin{equation}
	\frac{1}{m} \int_0^t F_m(t') \,\diffd t' = \zeta^2 + \mathcal{S} \zeta^3
\end{equation}
where $\zeta = R_i/R_o$, the Stefan number is $\mathcal{S} = \rho L R_o/m$ and
\begin{equation}
	m = \frac{2}{9} R_0^3 \rho c_p \frac{G T_m \delta \rho}{L}
\end{equation}
Real-world measurements give $\zeta = 1/3, \mathcal{S} = 0.4$, so growth is
controlled by the mantle heat flux balancing cooling (rather than latent
heat). Note that knowing $\zeta = 1/3$ does not allow a good estimate of the
age of the inner core, given the upper and lower bounds:
\begin{center}
	\begin{tikzpicture}[scale=2.5]
		\draw[thick,->] (-0.1, 0) -- (2.5, 0) node[right] {$t$ (Gyr)};
		\draw[thick,->] (0, -0.1) -- (0, 1.5) node[left] {$\zeta$};
		\draw[blue] plot[domain=0:2.5,samples=50] ({\x},{1-1/(\x+1)^2});
		\draw[blue] plot[domain=0:2.5,samples=50] ({\x},{1.3-2/(\x+1.24)^2});
		\draw (2.5, 1.15) node[right] {upper bound};
		\draw (2.5, 0.9) node[right] {lower bound};
		\draw[red,dashed] (0, 0.7) -- (0.826, 0.7);
		\draw[red,dashed] (0.826, 0.7) -- (0.826, 0);
		\draw[red,dashed] (0.586, 0.7) -- (0.586, 0);
	\end{tikzpicture}
\end{center}

\section{Flows in porous media}
To avoid the complexity of modelling very fine details, we model the flow
averaged over many \emph{pore scales} and assume viscous dissipation balances
the driving forces.

\begin{center}
	\begin{tikzpicture}[scale=2]
		\draw[fill=gray!20] plot[smooth cycle] coordinates  {(0,0) (0.5,
		-0.2) (2, 0.4) (1, 0.8)};
		\draw[fill=gray!20] plot[smooth cycle] coordinates  {(2,0.2) (2.7,
		0.5) (3.2, -0.2) (2.6, 0)};
		\draw[fill=gray!20] plot[smooth cycle]coordinates {(1, -1) (1.5, -1.3)
		(1.2, -2.1) (0.5, -2)};
		\draw[fill=gray!20] plot[smooth cycle]coordinates {(1, -0.2) (1.6, -0.3)
		(1.2, -0.9) (0.5, -0.6)};
		\draw[fill=gray!20] plot[smooth cycle]coordinates {(0, -0.3) (0.4,
		-0.5) (0.2, -0.9) (-0.5, -0.6)};
		\draw[fill=gray!20] plot[smooth cycle]coordinates {(0.5, -0.9)
			(0.75, -1.1) (0, -1.6) (-0.4, -1.3)};
		\draw[fill=gray!20] plot[smooth cycle]coordinates {(2, 0) (2.7,
		-0.4) (2.4, -0.8) (1.7, -0.3)};
		\draw[fill=gray!20] plot[smooth cycle] coordinates {(1.4, -0.9) (1.7,
		-0.5) (2.3, -1.1) (1.8, -1.4)};
		\draw[fill=gray!20] plot[smooth cycle] coordinates {(1.6, -1.5) (2.3,
		-1.8) (1.9, -2.1)};
		\draw[fill=gray!20] plot[smooth cycle] coordinates {(2, -1.45) (3,
		-1.2) (2.8, -2) (2.3, -1.6)};
		\draw[fill=gray!20] plot[smooth cycle] coordinates {(2.4, -1) (2.7,
		-0.8) (3, -0.35) (2.9, -1.1)};
		\draw[blue,->] plot[smooth] coordinates {(-0.5, 0) (0.3, -0.3) (1.4,
		-0.05) (2, 0.1) (3, -0.3) (3.5, -0.4)};
		\draw[blue,->] plot[smooth] coordinates {(-0.6, -1.1) (0, -1) (0.5,
		-0.85) (0.9, -0.95) (1.3, -1) (1.65, -1.4) (1.85, -1.5) (2.4, -1.2) (3,
	-1.15) (3.3, -1.05)};
		\draw[red,dashed] (0.5,0.2) rectangle (2.5, -1.8);
	\end{tikzpicture}
\end{center}

Define the \emph{porosity}
\begin{equation}
	\phi = \frac{\text{fluid volume}}{\text{total volume}}
\end{equation}
so that tightly packed media has low porosity and highly saturated media has
high porosity. For context, random close-packed spheres have $\phi \approx
0.37$ whilst hexagonally close-packed monodisperse spheres have $\phi = 1-
\pi/3\sqrt{2} \approx 0.26$. 

\subsection{Darcy's law}
Darcy's law represents the assumption that viscous dissipation at the pore
scale balances the driving forces, pressure and buoyancy. We have
\begin{equation}
	\mu \u = - \symsf{k}(\phi)(\nabla p + \rho g \hat{\symbf{z}})
\end{equation}
where $\u = \phi \tilde{\u}$ is the fluid flux per unit area and $\tilde{\u}$
is the \emph{interstitial fluid velocity}, i.e. the actual fluid velocity. The
tensor $\symsf{k}(\phi)$ is the \emph{permeability}, which characterises
the resistance to flow. In general, this is a tensor and depends on local
properties; for example long grain-like particles favour motion along their
long axis. $\symsf{k}$ reflects the geometry/tortuosity and porosity of the
medium. 
\begin{eg}
	The Kozeny-Carman equation for monodisperse random close packed spheres
	gives
	\begin{equation}
		\symsf{k} = \frac{d^2}{180} \frac{\phi^3}{(1-\phi)^2}
	\end{equation}
	where $d$ is the grain size.
\end{eg}

\subsection{Porous gravity currents}
Consider flows in a confined aquifer: we assume two fluids with density $\rho
+ \Delta \rho$ and $\rho$ separated by an interface $z=h(x,t)$ with the nose of
the gravity current at $x = x_N(t)$ in an aquifer of height $H$. There is a
volume flux $Q$ injected into the aquifer and background pressure $p_0(x,z,t)$.

\begin{center}
	\begin{tikzpicture}
		\draw[fill=gray!30, draw=none] (0,0) rectangle (5, -1);
		\draw[thick] (0,0) -- (5, 0);
		\draw[fill=gray!30, draw=none] (0,2) rectangle (5, 3);
		\draw[thick] (0, 2) -- (5, 2);
		\draw (0.5, 1.5) circle (0.2);
		\draw (0.5, 1.5) node {$1$};
		\draw (4.5, 1.5) circle (0.2);
		\draw (4.5, 1.5) node {$2$};
		\draw[<->] (5.5, 0) -- (5.5, 2) node[midway,right] {$H$};
		\draw[blue,smooth] plot coordinates {(1.5, 2) (1.6, 1.6) (2.5, 1)
		(3.4, 0.4) (3.5, 0)}; 
		\draw[<->,blue] (2.5,0) -- (2.5, 1) node[midway,left] {$h(x,t)$};
		\draw[blue] (4, 1) node {$\rho$};
		\draw[blue] (1, 1) node {$\rho + \Delta \rho$};
		\draw[blue] (3.5, 0) -- (3.5, -0.1) node[below] {$x_N(t)$};
		\draw[thick,->] (-1, 1) -- (0, 1) node[midway,above] {$Q$};
		\draw[->] (-0.8, 0) -- (-0.3, 0) node[below] {$x$};
		\draw[->] (-0.8,0) -- (-0.8, 0.5) node[left] {$z$};
	\end{tikzpicture}
\end{center}

The large aspect ratio implies the flow is mainly horizontal, hence pressure
is hydrostatic to leading order. The flow is driven by a combination of
buoyancy ($\sim \Delta \rho g$) and injection ($\sim Q$), and is primarily
horizontal. The pressure in the injected (lower) fluid is
\begin{equation}
	p_1 = p_0 - (\rho + \Delta \rho)gz
\end{equation}
whilst the pressure in the ambient (upper) fluid) is
\begin{equation}
	p_2 = p_0 - (\rho + \Delta \rho) gh - \rho g (z-h)
\end{equation}
The fluid flow is given by Darcy's law. For the injected fluid,
\begin{equation}
	u_1 = -\frac{k}{\mu} \frac{\partial p_1}{\partial x} = -\frac{k}{\mu}
	\frac{\partial p_0}{\partial x}
\end{equation}
Similarly, for the ambient fluid
\begin{equation}
	u_2 = -\frac{k}{\mu} \frac{\partial p_2}{\partial x} = -\frac{k}{\mu}
	\left( \frac{\partial p_0}{\partial x} - \Delta \rho g \frac{\partial
	h}{\partial x} \right)
\end{equation}

Now global conservation of the fluid flux gives
\begin{equation}
	Q = u_1 h + u_2 (H-h) = -\frac{k}{\mu} \left[ \frac{\partial p_0}{\partial
	x} h + \frac{\partial p_0}{\partial x}(H-h) - \Delta \rho g \frac{\partial
h}{\partial x} (H-h)\right]
\end{equation}
Rearranging for the background pressure gradient gives the injected fluid
velocity as
\begin{equation}
	u_1 = -\frac{k}{\mu} \frac{\partial p_0}{\partial x} = \frac{Q}{H} -
	\frac{k\Delta \rho g}{\mu} \frac{H-h}{H} \frac{\partial h}{\partial x}
\end{equation}
Local mass conservation in the lower (injected) layer gives
\begin{align}
	\phi \frac{\partial h}{\partial t} + \frac{\partial}{\partial x}(u_1 h) &=
	0 \label{eq:l6:masscons}\\
	\implies \phi \frac{\partial h}{\partial t} + \frac{\partial}{\partial
x}(\frac{Qh}{H}) &= \frac{k\Delta \rho g}{\mu} \frac{\partial}{\partial x}
\left[ \frac{H-h}{H} h \frac{\partial h}{\partial x}\right]
\end{align}
The first term is the change in fluid mass, the second the injection pressure
driven flux, and the RHS term is the buoyancy driven flux which is associated
with slumping due to the hydrostatic pressure. Note that typically the mass
flux $u_1 h$ in a viscous gravity current scales as $\sim h^3$, here the
scaling is $\sim h$ as the viscous drag is provided only at the bottom
boundary.

Consider a moving reference frame with coordinate
\begin{equation}
	y = x - \frac{Qt}{\phi H}
\end{equation}
Thus we treat $h$ as a function of $y$ and $t$: $h(x,t) = h(y(x,t),t)$. Then
\begin{equation}
\phi \frac{\partial h}{\partial t} = u_b \frac{\partial}{\partial y} \left[
\frac{H-h}{H} h \frac{\partial h}{\partial y}\right]
\end{equation}
where $u_b = k \Delta \rho g / \mu$ is the \emph{buoyancy velocity}. Assuming
$h \sim H$, scaling analysis gives
\begin{equation}
	\phi \frac{H}{t} \sim u_b \frac{H^2}{y^2} \implies y \sim \left( \frac{u_b
	H t}{\phi}\right)^{1/2}
\end{equation}
Hence introduce similarity variable $\zeta$ defined by
\begin{equation}
	\zeta = \frac{y}{\left(u_b H t/\phi\right)^{1/2}}
\end{equation}
and similarity solution $h = Hf(\zeta)$ where $f$ satisfies
\begin{equation}
	-\frac{\zeta}{2}f' = \left[ (1-f)ff'\right]'
	\label{eq:l6:1}
\end{equation}
with $-\lambda < \zeta < \lambda$ for some eigenvalue $\lambda$ to be
determined. The solution is
\begin{equation}
	f = \frac{1}{2}\left(1-\frac{\zeta}{\lambda}\right)
\end{equation}
which upon substitution into \eqref{eq:l6:1} gives $\lambda = 1$. The
interface slumps with width $\sim t^{1/2}$ in the travelling frame of
reference.
\begin{center}
	\begin{tikzpicture}[scale=2];
		\draw[thick] (0,0) -- (5,0);
		\draw[thick] (0, 2) -- (5, 2);
		\draw[blue] (0.5, 2) -- (0.5, 0) node[below,black] {$t_0$};
		\draw[dashed] (1.5, 2) -- (1.5, 0) node[below] {$t_1$};
		\draw[blue] (1.4, 2) -- (1.6, 0);
		\draw[dashed] (2.5, 2) -- (2.5, 0) node[below] {$t_2$};
		\draw[blue] (2.3, 2) -- (2.7, 0);
		\draw[dashed] (3.5, 2) -- (3.5, 0) node[below] {$t_3$};
		\draw[blue] (3.2, 2) -- (3.8, 0);
		\draw[dashed] (4.5, 2) -- (4.5, 0) node[below] {$t_4$};
		\draw[blue] (4.1, 2) -- (4.9, 0);
		\draw[<->] (4.1, 2.2) -- (4.5, 2.2) node[midway, above] {$\sim
		(t_4-t_0)^{1/2}$};
	\end{tikzpicture}
\end{center}

\subsection{Constant volume gravity current (porous \& unconfined)}
Consider the limit of the above problem $h \ll H$. This applies at early times
during injection or late times during constant volume expansion. 
\begin{center}
	\begin{tikzpicture}
		\draw[fill=gray!30, draw=none] (0,0) rectangle (5, -1);
		\draw[thick] (0,0) -- (5, 0);
		\draw[fill=gray!30, draw=none] (0,2) rectangle (5, 3);
		\draw (0, 1.5) circle (0.2);
		\draw (0, 1.5) node {$1$};
		\draw[->] plot[smooth] coordinates {(-0.2, 1.5) (-0.3, 1.0) (0, 0.4)};
		\draw (4.5, 1.5) circle (0.2);
		\draw (4.5, 1.5) node {$2$};
		\draw[thick] (0, 2) -- (5, 2);
		\draw[<->] (5.5, 0) -- (5.5, 2) node[midway,right] {$H$};
		\draw[<->,blue] (2,0) -- (2, 0.4) node[midway,left] {$h$};
		\draw[blue,smooth] plot coordinates {(0, 0.8) (1.8, 0.5) (2.5, 0)};
		\draw[blue] (4, 1) node {$\rho$};
		\draw[blue] (0.5, 0.3) node {$\rho + \Delta \rho$};
		\draw[->] (-0.8, 0) -- (-0.3, 0) node[below] {$x$};
		\draw[->] (-0.8,0) -- (-0.8, 0.5) node[left] {$z$};
	\end{tikzpicture}
\end{center}

Recall the injection flux $Q$ can be written as
\begin{equation}
	Q = -\frac{k}{\mu}\left[ H \frac{\partial p_0}{\partial  x} - \Delta \rho g
	(H-h)\frac{\partial h}{\partial x} \right]
\end{equation}
In the unconfined limit we have $h \ll H$ and $Q/H \approx 0$. Thus
\begin{equation}
	\frac{\partial p_0}{\partial x} = \Delta \rho g \frac{\partial h}{\partial
	x}
\end{equation}
Hence the apparent injected fluid velocity in region 1 is
\begin{equation}
	u_1 \approx -\frac{k}{\mu} \frac{\partial p_0}{\partial x} = -\frac{k
	\Delta \rho g}{\mu} \frac{\partial h}{\partial x}
\end{equation}
The governing equation for $h$ following from \eqref{eq:l6:masscons} is
\begin{equation}
	\phi \frac{\partial h}{\partial t} = \frac{k \Delta \rho
	g}{\mu}\frac{\partial}{\partial x} \left( h \frac{\partial h}{\partial
	x}\right)
\end{equation}
and the flux in the gravity current is
\begin{equation}
	q = \int_0^h u_1 \, \diffd z = -\frac{k\Delta \rho g}{\mu} h
	\frac{\partial h}{\partial x}
\end{equation}
Boundary conditions at the nose are $h(x_N) = 0$ and 
\begin{equation}
	q(x_N) = 0 = - u_b h \left.\frac{\partial h}{\partial x}\right|_{x_N}
\end{equation}
Despite the 2nd order governing equation, the undetermined nose position $x_N$
means a third condition is required. Global mass conservation is expressed as
\begin{equation}
	V = \phi \int_0^{x_N} h \, \diffd x
\end{equation}
where $V$ is the prescribed volume per unit width. This is equivalent to a
condition on the flux at $x=0$. The scalings are
\begin{align}
	\phi \frac{h}{t} &\sim u_b \frac{h^2}{x^2}, \hspace{2em} V \sim \phi h
	x \\
	\implies x &\sim  \left(\frac{u_b V}{\phi^2}\right)^{1/3} t^{1/3}
\end{align}
Hence we define a similarity variable:
\begin{equation}
	\eta = \frac{x t^{-1/3}}{(u_b V/\phi^2)^{1/3}}, \hspace{2em} h = \left(
	\frac{V^2}{u_b \phi}\right)^{1/3} t^{-1/3} f(\eta)
\end{equation}
where $0 \le \eta \le \eta_N$. The governing equation for $f(\eta)$ is then
\begin{align}
	-\frac{1}{3}f - \frac{\eta}{3}f' &= (ff')' \\
	\implies \eta f &= -3ff' + c
\end{align}
Now $h(x_N) = 0$ implies $c=0$. Hence $f' = -\eta/3$. The condition $q(x_N) =
0$ gives
\begin{equation}
	f = \frac{1}{6}\left(\eta^2_N - \eta^2\right)
\end{equation}
Global conservation of mass requires
\begin{equation}
	1 = \int_0^{\eta_N} f  \, \diffd \eta = \frac{1}{6}\left( \eta_N^3 -
	\frac{1}{3}\eta_N^3\right) = \frac{1}{9}\eta_N^3
\end{equation}
Thus the nose is located at $\eta_N = 9^{1/3} \approx 2.08$, or in terms of
the original coordinates
\begin{equation}
	x_N= 2.08 \left( \frac{u_b V t}{\phi^2}\right)^{1/3}
\end{equation}

\section{Convection in porous media}
A common example of convection in porous media is geothermal dissolution of
$CO_2$. The sequestration of CO$_2$ into water changes the density to
\begin{equation}
	\rho = \rho_0 (1+\beta C)
\end{equation}
where $C$ is the concentration of CO$_2$. 

\begin{center}
	\begin{tikzpicture}
		\draw[thick,->] (0,0) -- (5, 0) node [right] {$C$};
		\draw[thick,->] (0,0) -- (0, 3) node[left] {$\rho$};
		\draw (0, 1.5) -- (1, 1.8);
		\draw (0, 1.5) node[left] {$\rho_0$};
		\draw (0,0) -- (0, -0.1) node[below] {0, water};
		\draw (4,0.1)-- (4,-0.1) node[below] {1, CO$_2$};
		\draw[fill] (4, 0.6) circle (0.05);
		\draw (0.1, 0.6) -- (-0.1, 0.6) node[left] {$\rho_{\text{CO}_2}$};
	\end{tikzpicture}
\end{center}

The natural buoyancy velocity is then
\begin{equation}
	u_b \equiv \frac{\Delta \rho g k }{\mu} = \frac{\rho_0 \beta \Delta C g
	k}{\mu}
\end{equation}

Convection is driven by dissolution of CO$_2$ into water. The timescale to
convect over a distance $h$ is 
\begin{equation}
	\tau_{\text{ad}} \sim \frac{h}{u_b}
\end{equation}
whilst the timescale to diffuse over a distance $h$ is
\begin{equation}
	\tau_{\text{diff}} \sim \frac{h^2}{D}
\end{equation}
where $D$ is the diffusivity. We have convection if $\tau_{\text{ad}} <
\tau_{\text{diff}}$, hence
\begin{equation}
	\frac{h}{u_b} < \frac{h^2}{D} \implies \Ra = \frac{u_b h}{D} =
	\frac{\Delta \rho g k h }{\mu D}
\end{equation}
Note: it can be shown via similar analysis to pure convection that the onset
of porous convection is at $\Ra_{\text{crit}} = 4\pi^2$.

\subsection{Scaling for high $\Ra$ porous convection}
For $\Ra \gg \Ra_c$ convective flux becomes independent of the depth of
domain, as the interior is statistically well mixed as with high $\Ra$ pure
convection. The Nusselt number is
\begin{equation}
	\text{Nu} = \frac{F}{D\Delta C/h} \propto h \sim \Ra = \lambda \Ra =
	\frac{\lambda \rho_0 g \beta \Delta c k h}{D \mu}
\end{equation}
where $F$ is the convective flux. We therefore have
\begin{equation}
	F = \frac{\lambda \rho_0 g \beta k}{\mu} \Delta C^2 = \lambda u_b \Delta C
\end{equation}

\subsection{Dissolution from an unconfined aquifer}
Consider a convective flux from a constant volume gravity current in an
unconfined aquifer. Note that by constant volume we mean no input flux; the
volume will decrease due to convection.
\begin{center}
	\begin{tikzpicture}
		\draw (0,0) -- (5, 0);
		\draw[blue, smooth] plot[tension=0.8] coordinates {(0, -1.5) (2, -1.05)
		(3, 0)};
		\draw[blue] (3, 0) node[above] {$x_N(t)$};
		\draw[blue,<->] (1.5, 0) -- (1.5, -1.23) node[midway,left] {$h(x,t)$};
		\draw[red, snake it, ->] (0.5, -1.5) -- (0.5, -2.5);
		\draw[red, snake it, ->] (1, -1.45) -- (1, -2.45);
		\draw[red, snake it, ->] (1.5, -1.3) -- (1.5, -2.3);
		\draw[red, snake it, ->] (2, -1.1) -- (2, -2.1);
		\draw[red, snake it, ->] (2.5, -0.8) -- (2.5, -1.8);
		\draw[red, snake it, ->] (3, -0.2) -- (3, -1.2);
		\draw[red] (2, -2.5) node {$F$};
	\end{tikzpicture}
\end{center}

Since the problem is set in an unconfined aquifer we may assume the convective
flux $F$ is constant. The governing equation is then
\begin{equation}
	\phi \frac{\partial h}{\partial t} - u_b \frac{\partial}{\partial
	x}\left(h \frac{\partial h}{\partial x}\right) = -F
\end{equation}
Denote the initial volume of the gravity current as $V$ (note this is a 2D
volume). Non-dimensionalise the equations with scalings $h, x \sim
\sqrt{V/\phi}$ and $t \sim u_b^{-1}\sqrt{V/\phi}$.
\begin{equation}
	h_t - (h h_x)_x = -\varepsilon
\end{equation}
where $\varepsilon = F/u_b$. Recall that for $\varepsilon = 0$ we get a
self-similar solution:
\begin{equation}
	h_{\varepsilon=0} = t^{-1/3} f(xt^{-1/3}) = t^{-1/3}\cdot
	\frac{1}{6}(\eta_N^2 - \eta^2)
\end{equation}
where $\eta = xt^{-1/3}$ and $\eta_N = 9^{1/3}$. For this problem we try
ansatz $h= h_0 + ct$ for some undetermined constant $c$. Then
\begin{align}
	(h_0 + ct)_t &= ((h_0 + ct)(h_0)_x)_x - \veps \\
	\implies \cancel{h_{0t}} + c &= \cancel{(h_0h_{0x})_x} + ct h_{0xx} -
	\veps
\end{align}
Thus $c$ satisfies
\begin{equation}
	c = ct \cdot \frac{t^{-1/3}}{t^{2/3}} \left( -\frac{2}{6}\right) - \varepsilon
	\implies c = -\frac{3\veps}{4}
\end{equation}
The full solution is
\begin{equation}
	h = \frac{1}{6}t^{-1/3}\left(9^{2/3} - \frac{x^2}{t^{2/3}}\right) -
	\frac{3\veps t}{4}
\end{equation}
The extent of the current $x_N(t)$ is given by $h=0$
\begin{equation}
	\implies x_N(t) = \left(9^{2/3} t^{2/3} - \frac{9\veps}{2}t^2\right)^{1/2}
\end{equation}
\begin{center}
	\begin{tikzpicture}[scale=1.6]
		\draw[thick,->] (0,0) -- (4, 0) node[right] {$t$};
		\draw[thick,->] (0,0) -- (0, 2.5) node[left] {$x_N$};
		\draw[blue,smooth] plot[domain=0.01:3.246,samples=100]
		({\x},{sqrt(9^(2/3)*\x^(2/3) - 0.9*\x*\x)});
		\draw (1.424, 0.1) -- (1.424, -0.1) node[below] {$t_{\max}$};
		\draw (3.247, 0.1) -- (3.247, -0.1)  node[below] {$t_{\text{end}}$};
		\draw (0.1, 1.911) -- (-0.1, 1.911) node[left] {$x_{N,\max}$};
	\end{tikzpicture}
\end{center}

The maximum extent and the time at which it is reached are
\begin{align}
	x_{N,\max} &= \left(\frac{2^3}{3\veps}\right)^{1/4} \\
	t_{\text{end}} &= \left(\frac{2}{\veps}\right)^{3/4} 3^{-1/2}
\end{align}

\subsection{Charging/discharging of a groundwater aquifer}
Consider rainfall at rate $R$ charging a groundwater aquifer with depth
$h(x,t)$.
\begin{center}
	\begin{tikzpicture}
		\draw (0,0) -- (5, 0) node[below] {$x=L$};
		\draw (0,-0.15) node[below] {$x=0$};
		\draw[thick,->] (0,0) -- (1, 0) node[below] {$x$};
		\draw[thick,->] (0,0) -- (0, 1) node[left] {$z$};
		\draw[blue,fill=blue!60] (0,0) arc (0:-180:0.3);
		\draw[blue] (-1.2, 0) node {river};
		\draw[smooth,brown,thick] plot[domain=0.001:5,samples=100]
		({\x},{sqrt(\x)});
		\draw[smooth,blue] plot[domain=0.001:5,samples=100]
		({\x},{0.8*sqrt(\x)});
		\draw[dashed] (5,0) -- (5, 2.236);
		\draw (5.2, 1.2) node[right] {drainage};
		\draw (5.2, 0.8) node[right] {divide};
		\draw[brown] (5, 2.236) node[right] {ground};
		\draw[blue] (5, 1.789) node[right] {water table};
		\draw[blue,<->] (3, 0) -- (3, 1.386) node[midway,right] {$h(x,t)$};
		\draw[blue,snake it, ->] (1, 3.5) -- (1, 2.5);
		\draw[blue,snake it, ->] (2, 3.5) -- (2, 2.5);
		\draw[blue,snake it, ->] (3, 3.5) -- (3, 2.5);
		\draw[blue,snake it, ->] (4, 3.5) -- (4, 2.5);
		\draw[blue] (2.5, 3) node {$R$};
	\end{tikzpicture}
\end{center}

The groundwater table evolution is given by
\begin{equation}
	\phi\frac{\partial h}{\partial t} = u_b \frac{\partial}{\partial x}\left(
	h \frac{\partial h}{\partial x}\right) + R
\end{equation}
where $R$ is a top-hat function representing a period of rainfall:
\begin{center}
	\begin{tikzpicture}
		\draw[thick, ->] (-2,0) -- (3, 0) node[right] {$t$};
		\draw[thick,->] (0,0) -- (0, 2.5) node[left] {$R$};
		\draw (0,0) node[below] {$t=0$};
		\draw[blue] (-2,0) -- (0,0) -- (0, 1.5) -- (2, 1.5) -- (2, 0) --
		(3,0);
	\end{tikzpicture}
\end{center}
At the river, we assume $h(0, t) = 0$. At the drainage divide, which is the
boundary between catchment basins, $\left.h_x\right|_{x=L} = 0$ by definition.

\paragraph{Rainfall ($R \ne 0$).}
At early times when rain is falling, we start from $h(x,0) \approx 0$. The
far-field water table is $h_\infty \approx Rt/\phi$. Note at early times, the
extent of the water table is not important. Near the river,
\begin{equation}
	\frac{\phi h}{t} \sim u_b \frac{h^2}{x^2} \sim R
\end{equation}
Thus $h$ and $x$ scale as
\begin{equation}
	h \sim \frac{Rt}{\phi}, \hspace{2em} x \sim
	\left(\frac{u_b}{R}\right)^{1/2} h \sim
	\left(\frac{u_b}{R}\right)^{1/2}\frac{Rt}{\phi} \sim \left(\frac{u_b
	R}{\phi^2}\right)^{1/2} t
\end{equation}
The flux into the river is
\begin{equation}
	Q(0) = u_b h \left.\frac{\partial h}{\partial x} \right|_{x=0} \sim
	u_b\frac{h^2}{x} \sim \frac{u_b^{1/2} R^{3/2}}{\phi} t
\end{equation}

Note: there is a self-similar solution for the evolution near the river at
early times, with similarity variable $\eta$ and depth $h$ defined by
\begin{equation}
	\eta = \frac{x}{(u_bR/\phi^2)^{1/2} t}, \hspace{2em} h = \frac{Rt}{\phi}
	f(\eta)
\end{equation}
where $f(\eta)$ satisfies
\begin{equation}
	f - \eta f' = (ff')' + 1
\end{equation}
subject to $f(0) = 0, f'(\eta \to \infty) = 0$. The term `early times' here
refers to $x \ll L$, or equivalently
\begin{equation}
	t \ll \frac{\phi L}{(u_b R)^{1/2}}
\end{equation}

At late times, after a sustained period of rainfall, the solution reaches a
steady state $\partial_t = 0$ with
\begin{equation}
	\frac{h}{L} = \left(\frac{R}{u_b}\right)^{1/2} \sqrt{\frac{2x}{L} -
	\left(\frac{x}{L}\right)^2}
\end{equation}
The flux into the river in this steady state regime is
\begin{equation}
	Q = RL
\end{equation}

\paragraph{Aquifer discharge ($R=0$)}
When $R=0$, assuming $x \sim L$ (as there is no distinction close or far from
the river without rainfall) we have scalings
\begin{equation}
	\frac{\phi h}{t} \sim u_b \frac{h^2}{L^2} \hspace{2em} \implies h \sim
	\frac{\phi L^2}{u_b t}
\end{equation}
Use similarity solution $h = \frac{\phi L^2}{u_b t} g(\frac{x}{L})$ where $g$
satisfies
\begin{equation}
	-g = (gg')'
\end{equation}
subject to $g(0) = 0$ (zero height at the river) and $g'(1) = 0$ (no flux
across drainage divide). The flux into the river is
\begin{equation}
	Q = u_b\left. h \frac{\partial h}{\partial x}\right|_{x=0} \sim
	\frac{\phi^2 L^3}{u_b} t^{-2}
\end{equation}

\begin{center}
	\begin{tikzpicture}[scale=1.2]
		\draw[thick,->] (0,0) -- (5, 0) node[right] {$t$};
		\draw[thick,->] (0,0) -- (0, 2) node[left] {$R$};
		\draw[blue] (0,0) -- (1, 0) -- (1, 1.5) -- (3, 1.5) -- (3, 0) --
		(5,0);
		\begin{scope}[shift={(0,-3)}]
			\draw[thick,->] (0,0) -- (5, 0) node[right] {$t$};
			\draw[thick,->] (0,0) -- (0, 2) node[left] {$Q$};
			\draw[blue] (0,0) -- (1, 0);
			\draw[blue,smooth] plot[tension=0.8] coordinates {(1,0) (2, 1) (3,
			1.3)};
			\draw[blue,smooth] plot[tension=0.8] coordinates {(3, 1.3) (4,
			0.6) (5, 0.3)};
			\draw[blue!50, dashed] (1,0) -- (1.5, 0.65);
			\draw[blue] (1.1, 0.6) node	{\small $\sim t$};
			\draw[blue] (4.5, 0.8) node {\small $\sim 1/t^2$};
			\draw[blue] (2, -0.2) node {\tiny rapid increase};
			\draw[blue] (4, -0.2) node {\tiny slow discharge};
		\end{scope}
	\end{tikzpicture}
\end{center}

\subsection{Gravity currents with residual trapping}
Consider surface tension acting in a groundwater aquifer such that part of the
groundwater amount is \emph{residually trapped} in the pores that the gravity
current migrates through. 
\begin{center}
	\begin{tikzpicture}
		\draw[thick,->] (0,0) -- (8,0) node[right] {$x$};
		\draw[thick,->, name path = A] (0,0) -- (0,3) node[left] {$z$};
		\draw[blue, smooth, name path = B] plot[tension=0.7] coordinates {(0,
		2.5) (2.5, 2) (4.5, 0.7) (5, 0)};
		\draw[blue!75, smooth, name path = C] plot[tension=0.7] coordinates
		{(0, 2) (3.5, 1.7)  (6, 0.6) (6.5, 0)};
		\draw[dashed] (2.9, 0) -- (2.9, 1.75);
		\draw (2.9, 0) node[below] {$x_b(t)$};
		\draw[blue, <->] (1, 0) -- (1, 1.95) node[midway,right] {$h(x,t)$};
		\draw (6.5, 0) node[below] {$x_N(t)$};
		\tikzfillbetween[of=B and C, soft clip = {(0,2.5) rectangle (2.9,
		0)}]{gray, opacity=0.3};	
		\draw (1.5, 3) node {$s_r$};
		\draw (6, 2) node {$s_i$};
		\draw (1.4, 2.9) -- (1.2, 2.1);
		\draw (5.9, 1.9) -- (5, 0.8);
		\draw (0, 2.3) node[left] {\small residual trapping};
	\end{tikzpicture}
\end{center}

Define saturation by
\begin{equation}
	s = \frac{\text{pore space filled with water}}{\text{total
	pore space}}
\end{equation}
We will use two saturations in this problem: the initial saturation $s_i$
where the gravity current first reaches a region of the porous medium, and a
residual saturation $s_r$ after the current has passed through.

The governing equations for the \emph{mobile} fluid are
\begin{align}
	\phi s_i h_t &= u_b (h h_x)_x &&x_b < x < x_N, \,\,\, h_t > 0 \\
	\phi s_i h_t &= u_b (h h_x)_x + \phi s_r h_t  &&0 < x < x_b, \,\,\, h_t < 0
\end{align}
Note that in the region $0 < x < x_b$ the height is decreasing so $\phi s_r
h_t$ is a \emph{loss} term. The buoyancy velocity $u_b = \Delta \rho g k/\mu$
as usual for a gravity current. The boundary conditions on $h$ are
\begin{align}
	h_x(0) &= 0 &&\text{no input flux}\\
	h(x_N) &= 0 &&\text{zero height at nose}\\
	-u_b \left. h h_x \right|_{x_N} &= 0 &&\text{zero mass flux through nose} \\
	\dif{h(x_b)} &= 0 &&\text{continuity of height} \\
	\dif{-u_b \left. h h_x \right|_{x_b}} &= 0 &&\text{continuity of mass
	flux} \\
	h_t(x_b) &= 0 &&\text{defines boundary $x_b$}
\end{align}
We also supplement the problem with a constant volume initial condition
\begin{equation}
	V = \phi s_i \int_0^{x_N(0)} h(x,0) \, \diffd x
\end{equation}

To simplify notation, define
\begin{align}
	\mathcal{U}_i &= \begin{cases} \mathcal{U}_1 = \frac{u_b}{\phi s_i} & h_t
	> 0 \\ \mathcal{U}_2 = \frac{u_b}{\phi(s_i-s_r)} &h_t < 0 \end{cases} \\
	\mathcal{V} &= \frac{V}{\phi s_i} = \int_0^{x_N(0)} h(x,0) \, \diffd x
\end{align}
so that the governing equation is
\begin{equation}
	h_t = \mathcal{U}_i(hh_x)_x
\end{equation}
subject to the same boundary conditions, except $\mathcal{U}_1$ replaces $u_b$
in the mass flux conditions.


Recall that for $s_r = 0$, $\mathcal{U}_1 = \mathcal{U}_2$ with solution
\begin{equation}
	h = \left( \frac{\mathcal{V}^2}{\mathcal{U}_1 t}\right)^{1/3} f(\eta),
	\hspace{2em} \eta = \frac{x}{(\mathcal{U}_1\mathcal{V}t)^{1/2}},
	\hspace{2em} f = \frac{1}{6}\left( 9^{2/3} - \eta^2\right)
\end{equation}
For $s_r \ne 0$, $\mathcal{U}_1 \ne \mathcal{U}_2$ and the initial condition
is remembered, so we look for an incomplete self-similar solution, known as a
self-similar solution of the \emph{second type}. Define similarity variable
\begin{equation}
	\eta_0 = \frac{x_0}{(\mathcal{U}_1\mathcal{V}t)^{1/3}}
\end{equation}
where $x_0 = x_N(0)$ and specify $h$ with an undetermined parameter $\gamma$ as
\begin{equation}
	h = \eta_0^\gamma \left( \frac{\mathcal{V}^2}{\mathcal{U}_1t}\right)^{1/3}
	f\left(\frac{\eta}{\eta_0^\gamma},\frac{\mathcal{U}_1}{\mathcal{U}_2}\right)
\end{equation}
To simplify notation we define $\zeta = x/Bt^\beta$, $\tilde{\mathcal{U}} =
\mathcal{U}_1/\mathcal{U}_2$ and $h = A t^{-\alpha} f(\zeta,
\tilde{\mathcal{U}})$ (where $A$ and $B$ may be determined by comparison with
the original definitions) so that the governing equation gives
\begin{equation}
	-\alpha A t^{-\alpha-1} f - \frac{\beta \zeta}{t}At^{-\alpha} f' =
	\mathcal{U}_i \frac{A^2 t^{-2\alpha}}{B^2 t^{2\beta}} (ff')'
\end{equation}
which simplifies to
\begin{equation}
	-\frac{B^2}{A} t^{2\beta + \alpha -1} (\alpha f + \zeta \beta f') =
	\mathcal{U}_i(ff')'
\end{equation}
Note that by introducing $B$ and $A$, one of them is a free parameter, which
we choose to satisfy $B^2/A = \mathcal{U}_2$. For self-similar behaviour we
need
\begin{equation}
	\alpha + 2\beta -1 = 0 \implies \alpha = 1 - 2\beta
\end{equation}
The governing equations are therefore
\begin{align}
	(ff')' + \beta \zeta f' + (1-2\beta) f &= 0 && h_t < 0 \\
	\tilde{\mathcal{U}}(ff')' + \beta \zeta f' + (1-2\beta) f &= 0 && h_t > 0
\end{align}
with boundary conditions
\begin{align}
	f(\zeta_N) &= 0 \\
	f'(0) &= 0 \\
	-\left.ff'\right|_{\zeta_N} &= 0 \\
	\dif{f(\zeta_b)} &= 0 \\
	\dif{-\left.ff'\right|_{\zeta_b}} = \dif{f'(\zeta_b)} &= 0 
\end{align}
The governing equations are satisfied only for eigenvalues $\beta$. The
boundary position $\zeta_b$ is then determined by
\begin{equation}
	h_t(x_b) = 0 \implies \beta \zeta_b f'(\zeta_b) + (1-2\beta) f(\zeta_b) =
	0
\end{equation}

\paragraph{Small trapping limit.}
Consider the limit of small trapping $s_r \ll s_i$, where we can make
analytical progress. Let $U_1 = U_2(1-\veps)$ with $\veps \ll 1$. Then
\begin{equation}
	\tilde{U} \equiv \frac{U_1}{U_2} = 1-\veps
\end{equation}
The rate of change of total volume of mobile fluid is
\begin{align}
	\frac{\diffd}{\diffd t} \int_0^{x_N} h \, \diffd x 
	&= \int_0^{x_N} U_i (hh_x)_x \, \diffd x \\
	&= \left.U_2 hh_x \right|_{x_b^-} - \left. U_1 hh_x\right|_{x_b^+}
	\label{eq:l10:1}
\end{align}
Using the form $h = A t^{-\alpha}f(\zeta, 1-\veps)$, with $\zeta =
x/Bt^\beta$, gives
\begin{align}
	\frac{\diffd}{\diffd t} \int_0^{x_N} h \, \diffd x 
	&= \frac{\diffd}{\diffd t} \left[ AB t^{\beta-\alpha} \int_0^{x_N} f \,
	\diffd \zeta \right] \\
	&= (\beta - \alpha) AB t^{\beta-\alpha-1} \int_0^{\zeta_N} f \, \diffd
	\zeta \\
	&= U_2 \frac{(At^{-\alpha})^2}{Bt^\beta} \left[
	\left.ff'\right|_{\zeta_b^-} -
	(1-\veps)\left.ff'\right|_{\zeta_b^+}\right]
\end{align}
where the final equality follows from \eqref{eq:l10:1}. Now using $B^2/A
\equiv U_2, \alpha = 1-2\beta$ and the boundary condition $ff'$ continuous at
$\zeta=\zeta_b$, we have
\begin{equation}
	(3\beta -1)\int_0^{\zeta_N} f \, \diffd \zeta = \veps \left.
	ff'\right|_{\zeta_b^+} \label{eq:l10:2}
\end{equation}

When $\veps = 0$, we have $\beta = 1/3$ exactly. If $\veps =0 $ we also have
$f = (\zeta_N^2 - \zeta^2)/6$ with $\zeta_N = 9^{1/3}$. The condition
$h_t(x_b) = 0$ gives
\begin{align}
	\left.f\right|_{\zeta_b} + \zeta_b \left. f'\right|_{\zeta_b} &= 0 \\
	\implies \zeta_b &= \zeta_N/\sqrt{3}
\end{align}
Hence assuming $\beta$ is an $\mathcal{O}(\veps)$ correction to $1/3$,
\eqref{eq:l10:2} becomes
\begin{align}
(3\beta-1) \int_0^{\zeta_N} \frac{1}{6}\left(\zeta_N^2 - \zeta^2\right) \,
\diffd \zeta &= \veps \cdot \frac{1}{6}\left(\zeta_N^2 - \zeta_b^2\right)\cdot
-\frac{2}{6}\zeta_b \\
\implies \beta &= \frac{1}{3}-\frac{\veps}{3^{5/2}} \\
			   &= \frac{1}{3}-\frac{s_r/s_i}{3^{5/2}}
\end{align}

\section{Saffman-Taylor fingering}
\emph{Saffman-Taylor fingering} (also \emph{viscous fingering}) is an
instability between fluid of viscosity $\mu_1$ injected into a porous medium
saturated with fluid of viscosity $\mu_2$. In the case of a solid-liquid
interface, this is also called \emph{Mullins-Sekeika fingering} (or
\emph{morphological instability}).
. 

\begin{center}
	\begin{tikzpicture}
		\draw[dashed] (0,0) -- (0, 5);
		\draw[smooth,blue] plot[domain=0:5] ({0.5*sin(3*deg(\x))},{\x});
		\draw (1.5, 2.5) node {$\mu_2$};
		\draw (-1.5, 2.5) node {$\mu_1$};
		\draw[thick,->] (-0.75, 3) -- (0.75, 3) node[above] {$U$};
		\draw[thick,->] (0, 0) -- (0, 1) node[left] {$z$};
		\draw[thick,->] (0, 0) -- (1, 0) node[right] {$y$};
		\draw (-2, 5) circle (0.3);
		\draw (-2, 5) node {1};
		\draw (2, 5) circle (0.3);
		\draw (2, 5) node {2};
	\end{tikzpicture}
\end{center}

\paragraph{Basis for instability.}
Darcy's law gives $\u_i = -k/\mu_i \nabla p_i$ for $i=1,2$. Since the
interface moves at velocity $U$ we have
\begin{equation}
	U = u_1 = -\frac{k}{\mu_1} \frac{\partial p_1}{\partial x} = u_2 =
	-\frac{k}{\mu_2} \frac{\partial p_2}{\partial x}
\end{equation}

If $\mu_1 < \mu_2$ then the pressure gradient is greatest in fluid 2, so
the fingering perturbations grow and we have instability. If instead $\mu_1 >
\mu_2$ then the perturbations decay and we have stability.

\begin{center}
	\begin{tikzpicture}[scale=1.2]
		\draw[thick,->] (0,0) -- (5, 0) node[right] {$x$};
		\draw[thick,->] (0,0) -- (0, 3) node[left] {$p$};
		\draw[dashed] (2, 0) -- (2, 3);
		\draw[blue] (0, 2) -- (4, 0);
		\draw[blue] (4.5, 0.5) node {$\mu_1 = \mu_2$};
		\draw[red] (0, 2) -- (2, 0.5) -- (4, 0);
		\draw[red] (1, 0.6) node {$\mu_1 > \mu_2$};
		\draw[red] (1, 0.3) node {stable};
		\draw[red] (0, 2) -- (2, 1.5) -- (4, 0);
		\draw[red] (3, 2) node {$\mu_1 < \mu_2$};
		\draw[red] (3, 1.7) node {unstable};
		\draw (0, 2) -- (-0.1, 2) node[left] {$p_{\text{in}}$};
		\draw (0, 0) -- (-0.1, 0) node[left] {$p_{\text{out}}$};
	\end{tikzpicture}
\end{center}

\paragraph{Pressure fields.}
Consider a travelling frame of reference $y = x-\frac{Ut}{\phi}$. Then
\begin{align}
	p_1 &= -\frac{\mu_1 U}{k} y + p_0 \\
	p_2 &= -\frac{\mu_2 U}{k} y + p_0
\end{align}
Now consider perturbations to the interface of the form
\begin{equation}
	y = \eta(z,t) = \tilde{\eta} e^{i\alpha z + \sigma t}
\end{equation}
Darcy's law and incompressibility (equivalently conservation of mass) give
\begin{equation}
	\u_i = -\frac{k}{\mu_i} \nabla p_i, \hspace{1em} \nabla \cdot \u_i = 0
	 	 \implies \nabla^2 p_i = 0
\end{equation}
Hence the pressure field, including perturbations, must be of the form
\begin{equation}
	p_1 = p_0 - \frac{\mu_1 U}{k}y + \hat{p}_1(y)e^{i\alpha z + \sigma t}
\end{equation}
Requiring $\nabla^2 p_1 = 0$ gives
\begin{align}
	\frac{\partial^2 \hat{p}_1}{\partial y^2} - \alpha^2 \hat{p}_1 &= 0 \\
	\implies \hat{p}_1(y) &= Ae^{\alpha y} 
\end{align}
where we have used the requirement that perturbations decay away from the
interface. Applying the same theory to $p_2$ gives the pressure fields as
\begin{align}
	p_1 &= p_0 - \frac{\mu_1 U}{k} y + Ae^{i\alpha z + \alpha y + \sigma t} \\
	p_2 &= p_0 - \frac{\mu_2 U}{k} y + Ae^{i\alpha z - \alpha y + \sigma t}
\end{align}
Next, match pressures and velocities at the interface. Pressure continuity
along the perturbed interface requires
\begin{align}
	p_1(\eta) &= p_2(\eta)\\
	\implies \left.p_1 \right|_0 + \left. \frac{\partial p_1}{\partial
y}\right|_0 \hat{\eta} &= \left.p_2 \right|_0 + \left. \frac{\partial p_2}{\partial
y}\right|_0 \hat{\eta} \\
\implies p_0 + A + \left(-\frac{\mu_1 U}{k} + \cancel{\alpha
A}\right)\hat{\eta} &= 
p_0 + B + \left(-\frac{\mu_2 U}{k} - \cancel{\alpha
B}\right)\hat{\eta}
\end{align}
Cancelled terms are negligible since $A, B = \mathcal{O}(\hat{\eta})$, i.e. 
terms are second order. Velocity continuity at the interface requires
\begin{equation}
	\left[\u \cdot \hat{\symbf{n}}\right]_{y=\eta} = 0 
\end{equation}
where $\hat{\symbf{n}}$ is the unit normal to the interface.  Taylor expanding
as before, we have
\begin{equation}
	\left.u_1\right|_0 + \left. \frac{\partial u_1}{\partial y}\right|_0
	\hat{\eta} = \left.u_2\right|_0 + \left. \frac{\partial
	u_2}{\partial y} \right|_0 \hat{\eta}
\end{equation}
Now note
\begin{equation}
	\phi \frac{\partial \eta}{\partial t} = \phi \sigma \hat{\eta} =
	-\frac{k}{\mu_1} \alpha A = \frac{k}{\mu_2}\alpha B
\end{equation}
Hence the velocity continuity condition becomes
\begin{align}
	-\frac{\mu_1 \phi \sigma}{k \alpha} - \frac{\mu_1 U}{k}\hat{\symbf{\eta}}
	&= \frac{\mu_2 \phi \sigma}{k \alpha} \hat{\eta} - \frac{\mu_2
	U}{k}\hat{\eta}  \\
	\implies \sigma &= \frac{\alpha U}{\phi} \frac{\mu_2 - \mu_1}{\mu_2 + 
	\mu_1}
\end{align}
Hence the system is unstable for $\mu_2 > \mu_1$, as expected. Most unstable
for $\alpha \to \infty$, i.e. the smallest wavelengths (UV catastrophe).
Thus regularisation needed: additional physics at the smallest wavelengths,
e.g. surface tension. Surface tension introduces a pressure discontinuity at
the interface
\begin{equation}
	p_1 - p_2 = \gamma \kappa = 2\gamma \nabla \cdot \hat{\symbf{n}}
\end{equation}
where $\hat{\symbf{n}}$ is the normal to the interface as before. Hence
\begin{equation}
	\hat{\symbf{n}} = \frac{\nabla (y-\eta)}{\abs{\nabla(y-\eta)}} \approx
	\hat{\symbf{y}} - \eta_z \hat{\symbf{z}}
\end{equation}
Then $\nabla \cdot \symbf{\hat{n}} = -\eta_{zz}$, so the pressure condition
becomes
\begin{align}
	\left.p_1 \right|_0 + \left. \frac{\partial p_1}{\partial
y}\right|_0 \hat{\eta} &= \left.p_2 \right|_0 + \left. \frac{\partial p_2}{\partial
y}\right|_0 \hat{\eta} -2\gamma \eta_{zz} \\
\implies p_0 + A - \frac{\mu_1 U}{k}\hat{\eta} &= p_0 + B - \frac{\mu_2
U}{k}\hat{\eta} + 2\gamma \alpha^2 \hat{\eta}
\end{align}
where the second order terms are dropped as before. The growth rate is then
\begin{align}
	\sigma &= \frac{\alpha U}{\phi} \left( \frac{\mu_2 - \mu_1}{\mu_2 + \mu_1}
	- \alpha^2 \frac{2\gamma k}{(\mu_2+\mu_1)U}\right) \\
		   &= \frac{\alpha U}{\phi} \left( m - \frac{m+1}{\text{Ca}} k
		   \alpha^2\right)
\end{align}
where $m$ is the \emph{mobility ratio}
\begin{equation}
	m = \frac{\mu_2 - \mu_1}{\mu_2 + \mu_1}
\end{equation}
and $\text{Ca} = \mu_2 U/\gamma$ is the \emph{capillary number}.

\begin{center}
	\begin{tikzpicture}[scale=1.6]
		\draw[thick,->] (0,0) -- (4, 0) node[right] {$\alpha$};
		\draw[thick,->] (0,-0.3) -- (0, 2) node[left] {$\sigma$};
		\draw[smooth,blue] plot[domain=0:3.4] ({\x},{\x*(1-0.1*\x*\x)});
		\draw (0.1, 1.217) -- (-0.1, 1.217) node[left] {$\sigma_{\max}$};
		\draw (1.826, 0.1) -- (1.826, -0.1) node[below] {$\alpha_{\max}$};
	\end{tikzpicture}
\end{center}

Maximum growth rate occurs at wavelength
\begin{equation}
	\alpha_{\max} = \left(\frac{\text{Ca}\,m}{3(m+1)}\right)^{1/2} k^{-1/2}
\end{equation}
Surface tension suppresses the smallest wavelengths, providing wavelength
selection for the instability.

\section{Solidifcation of binary eutectic mixtures}
A natural example is the solidification of sea ice in polar oceans. The
problem is an extension of previous solidification problems with concentration
as an additional species to handle. Consider a phase diagram of temperature
and concentration:
\begin{center}
	\begin{tikzpicture}
		\draw[thick,->] (0,0) -- (0, 5) node[left] {$T$};
		\draw[thick] (0,0) -- (8, 0) node[midway,below] {$C$};
		\draw[thick] (8,0) -- (8, 5);
		\draw (0,0) node[below] {water};
		\draw (8,0) node[below] {salt};
		\draw (8, -0.4) node[below] {NaCl};
		\draw[blue,smooth] plot[tension=0.8] coordinates {(0, 2) (1.5, 1.6) (3, 0)};
		\draw[blue,smooth] plot[tension=0.8] coordinates {(0, 2) (1.5*0.2,
		1.6) (3*0.2, 0)};
		\draw[blue,smooth] plot[tension=0.8] coordinates {(8, 4.5) (5, 3.5) (3, 0)};
		\draw[blue,smooth] plot[tension=0.8] coordinates {(8, 4.5) (8-3*0.2,
		3.5) (8-5*0.2, 0)};
		\draw[blue] (3, 4) node {liquid};
		\draw (0, 2) -- (-0.1, 2) node[left] {$T_m (0^{\circ}C)$};
		\draw (0, 0) -- (-0.1, 0) node[left] {$T_E (\sim -21^{\circ}C)$};
		\draw (8, 4.5) -- (8.1, 4.5) node[right] {$801^{\circ}C$};
		\draw (3, 0) -- (3, -0.1) node[below] {$C_E$};
		\draw (1.2, 2) node[blue,rotate=-20] {liquidus $T_L$};
		\draw (1.5, 0.7) node[blue] {\small mushy};
		\draw (1.5, 0.4) node[blue] {\small layer};
		\draw (-1.5, 1) node[blue] {solidus $T_S$};
		\draw[blue,->] (-0.5, 1) -- (0.4, 1);
		\draw[blue] (0.25, 0.5) node[rotate=90] {\tiny solid};
	\end{tikzpicture}
\end{center}

\begin{itemize}
	\item The freezing/melting temperature or \emph{liquidus} is a function of
		concentration:
		\begin{equation}
			T_L = T_L(C)
		\end{equation}
	\item The solution is solid below the \emph{solidus} 
		\begin{equation}
			T_S(C) = k_D T_L(C)
		\end{equation}
		where $k_D$ is the \emph{partition coefficient}. For ice, $k_D \approx
		0$ so ice is `pure' water.

	\item Between the solidus and liquidus, solid and liquid phases coexist in
		equilibrium.
	\item The \emph{eutectic temperature} $T_E$ is the temperature at which
		both water and salt form ice crystals. Below $T_E$, a solid solution
		forms.
\end{itemize}

For a freezing system, the interfacial conditions are now obtained by
\emph{both} temperature and concentration considerations.

\begin{center}
	\begin{tikzpicture}
		\draw[fill=gray!20,draw=none] (0,0) rectangle (-0.5, 3);
		\draw[thick] (0,0) -- (0, 3);
		\draw[dashed] (2, 0) -- (2, 3);
		\draw (1, 3.5) node {solid};
		\draw[red,fill] (0, 0.3) circle (0.05);
		\draw[red] (0, 0.3) node[left] {$T_B$};
		\draw[red] (0, 0.3) -- (2, 1.3);
		\draw[red,fill] (2, 1.3) circle (0.05);
		\draw[red] (2, 1.3) node[left] {$T_i$};
		\draw[red, smooth] plot coordinates {(2, 1.3) (2.5, 1.55)
		(3.2, 1.7) (5, 1.8) (6, 1.8)};
		\draw[red] (6, 1.8) node[right] {$T_\infty$};
		\draw[blue] (0, 0) -- (2, 0);
		\draw[blue,dashed] (2, 0) -- (2, 0.8);
		\draw[blue,fill] (0,0) circle (0.05);
		\draw[blue] (0, 0) node[left] {$C_S$};
		\draw[blue,fill] (2, 0.8) circle (0.05);
		\draw[blue,smooth] plot coordinates {(2, 0.8) (2.5, 0.3) (4, 0.1)
		(6,0.1)};
		\draw[blue] (6, 0.1) node[right] {$C_0$};
		\draw (2, -0.2) node {$x=a(t)$};
	\end{tikzpicture}
\end{center}
Note $T_i = T_L(C_i)$ and take $C_S = 0$ i.e. the solid is pure ice. Assume a
liquidus of the form
\begin{equation}
	T_L(C) = -mC
\end{equation}
so that $T_m = 0^{\circ}C$.  Temperature is governed by
\begin{equation}
	\frac{\partial T}{\partial t} = \kappa \frac{\partial^2 T}{\partial x^2}
	\hspace{2em} 0 < x < \infty
\end{equation}
where we have assumed equal thermal properties in each phase. Concentration is
governed by
\begin{equation}
	\frac{\partial C}{\partial t} = D \frac{\partial^2 C}{\partial x^2}
	\hspace{2em} a < x < \infty
\end{equation}
where $D$ is the salt diffusivity. The interfacial conditions are
\begin{align}
	T_i &= T_L(C_i) = -mC_i\\
	\rho L \dot{a} &= k\left.\frac{\partial T}{\partial x}\right|_{a^-} - k
	\left.\frac{\partial T}{\partial x}\right|_{a^+} \hspace{2em} \text{Stefan
	condition}\\
	(C_i-C_S)\dot{a} &= -D \left.\frac{\partial C}{\partial x}\right|_{a^+}
	\hspace{3em} \text{Conservation of solute}
\end{align}

\subsection{Morphological instability}
Consider the case of solidification \& viscous fingering at a solid-liquid
interface, known as morphological instability. This instability:
\begin{itemize}
	\item increases surface area of the interface
	\item enhances the release of latent heat
	\item raises temperature $T$
	\item enhances rejection of solute (within interstices)
\end{itemize}

\begin{center}
	\begin{tikzpicture}
		\draw[fill=gray!20,draw=none] (0,0) rectangle (-1.5, 3);
		\draw[thick] (0,0) -- (0, 3);
		\draw[dashed] (1.5, 0) -- (1.5, 3);
		\draw (-0.75, 3.5) node {solid};
		\draw (3, 3.5) node {liquid};
		\draw[red] (-1.5, 0.5) -- (0, 1.3);
		\draw[red, smooth] plot coordinates {(0, 1.3) (0.5, 1.55)
		(1.2, 1.7) (3, 1.9) (4, 1.95)};
		\draw[purple, smooth] plot[tension=0.5] coordinates {(0, 1.3) (0.5, 1.65)
		(1.2, 1.72) (3, 1.8) (4, 1.8)};
		\draw[red] (4, 2) node[right] {$T_\infty$};
		\draw[purple] (4, 1.65) node[right] {$T_L(C)$};
		\draw[blue] (-1.5, 0) -- (0, 0);
		\draw[blue] (-1.5, 0) node[left] {$C_S = 0$};
		\draw[blue,smooth] plot coordinates {(0, 0.8) (0.5, 0.3) (2, 0.1)
		(4,0.1)};
		\draw[blue] (4, 0.1) node[right] {$C_0$};
		\draw (0.75, -0.5) node {constitutional};
		\draw (0.75, -1) node {supercooling};

		\draw[very thick, ->] (5, 1.5) -- (6, 1.5);
		\draw (6.5, 3) -- (6.5, 0);
		\draw[dashed] (7.5, 3) -- (7.5, 0);
		\draw[dashed] (8.5, 3) -- (8.5, 0);
		\draw[red] (6.5, 1) -- (8.5, 2) -- ( 10, 2) node[right] {\small $T_\infty$};
		\draw[red] (7, 0.8) node {\tiny $T_L(C)$};
		\draw[blue,smooth] plot[domain=0:3,samples=100] ({8+0.4*sin(10*deg(\x))},{\x});
		\draw (8, -0.5) node {region of mixed};
		\draw (8, -1) node {phase `mushy layer'};
	\end{tikzpicture}
\end{center}

The phenomenon leads to a porous medium in thermodynamic equilibrium with a
\emph{solid fraction} $\phi$ (note the clash of notation!) determined by local
$T, C$ via liquidus $T_L(C)$.

\paragraph{Global conservation of solute.}
Conservation of solute in the mushy layer between $0 \le x \le b(t)$ is
expressed by
\begin{equation}
	\int_0^{b(t)} (1-\phi)C_L(T) \, \diffd x = C_0 b(t)
\end{equation}
where $\phi(x,t)$ is the local volume fraction of solid, i.e. $1-\phi$ is the
\emph{liquid fraction}. Here, $C_L(T)$ is the liquidus concentration
determined by the temperature. That is, in the mushy layer we have interstices
of pure solid with $C_S =0$ and $C_L$ is the concentration of the liquid in
between. $C_0$ is the concentration of the solute in the liquid.

\begin{center}
	\begin{tikzpicture}
		\draw[thick] (0,0) -- (5, 0) node[right] {$x=0$};
		\draw[dashed](0, 2) -- (5, 2) node[right] {$x=b(t)$};
		\draw (2.5, -1) node {solid};
		\draw (2.5, 3) node {liquid};
		\draw[red] (3, 0) -- (4, 2) node[above] {$T_0$};
		\draw[red] (3,0) node[below] {$T_B$};
		\draw[purple] (1,2) -- (2.5, 0);
		\draw[purple] (1,2) node[above] {$C_0$};
		\draw[purple] (1,-0.5) node[below] {$C_S=0$};
		\draw[purple,->] (1,-0.5) -- (1, 0.5);
		\draw[blue,smooth] plot coordinates {(0.3, 0) (0.4, 0.4) (0.35, 0.5)
		(0.6, 1) (0.55, 1.2) (0.8, 1.5) (0.75, 1.6) (1, 1.7) (1.2, 1.5) (1.3,
		1.4) (1.45, 0.9) (1.4, 0.8) (1.6, 0.4) (1.55, 0.3) (1.7, 0)};
		\begin{scope}[shift={(1.4,0)}]
			\draw[blue,smooth] plot coordinates {(0.3, 0) (0.4, 0.4) (0.35, 0.5)
			(0.6, 1) (0.55, 1.2) (0.8, 1.5) (0.75, 1.6) (1, 1.7) (1.2, 1.5) (1.3,
			1.4) (1.45, 0.9) (1.4, 0.8) (1.6, 0.4) (1.55, 0.3) (1.7, 0)};
		\end{scope}
		\begin{scope}[shift={(2.8,0)}]
			\draw[blue,smooth] plot coordinates {(0.3, 0) (0.4, 0.4) (0.35, 0.5)
			(0.6, 1) (0.55, 1.2) (0.8, 1.5) (0.75, 1.6) (1, 1.7) (1.2, 1.5) (1.3,
			1.4) (1.45, 0.9) (1.4, 0.8) (1.6, 0.4) (1.55, 0.3) (1.7, 0)};
		\end{scope}
	\end{tikzpicture}
\end{center}

We will use a simplified model of \emph{bulk} properties:
\begin{enumerate}
	\item Take quasi-static approximation for temperature:
		\begin{equation}
			T = T_B + (T_0-T_B)\frac{x}{b}
		\end{equation}
		where $T_0 = T_L(C_0)$.
	\item All impurities are accomodated within the mushy layer, i.e. $C =
		C_0$ for $x > b(t)$.
	\item Linear liquid approximation
		\begin{equation}
			T_L = T_0 - m(C-C_0)
		\end{equation}
	\item Ignore heat transfer in liquid
\end{enumerate}

\paragraph{Box model.}
Consider the `trial function' $\phi =$ const. in global solute conservation.
We have
\begin{equation}
	\int_0^b (1-\phi)C_L(T)\,\diffd x \approx (1-\phi) \frac{C_B + C_0}{2} b =
	C_0 b
\end{equation}
Then the solid fraction may be written
\begin{equation}
	\phi = \frac{1}{2\C -1}
\end{equation}
where $\C = C_B/(C_B-C_0)$. Note when $\C \gg 1$, we can approximate $\phi
\approx 1/2\C \approx \mathcal{O}(\C^{-1})$. With the same trial function, the
Stefan condition gives
\begin{equation}
	\phi \rho_S L \dot{b} = \overline{k}(\phi) \frac{T_0 - T_B}{b}
\end{equation}
where $\overline{k} = k_s \phi + k_l (1-\phi)$ which is exact for 
\emph{lamella} (solidification fingers) parallel to $\nabla T$. The boundary
position is then
\begin{equation}
	b = \left( \frac{2}{\S} \frac{\overline{k}}{k_s \phi} \kappa_s
	t\right)^{1/2}
\end{equation}
where $\S$ is the Stefan number defined by
\begin{equation}
	\S = \frac{L}{c_p(T_0-T_B)}
\end{equation}
Note that for $k_l \ll k_s$ we have
\begin{equation}
	\frac{\overline{k}}{k_s \phi} = 1+ \frac{k_l}{k_s} \frac{1-\phi}{\phi}
	\approx 1
\end{equation}
For ice, $k_s \approx 5 k_l$. Also note: growth of mushy layer scales as $b
\propto \sqrt{\kappa t}$ which is constrained by the thermal field, \emph{not}
diffusion of solute.

\paragraph{`Ideal' mushy layer.} Take $\rho, c_p, k$ independent of phase. The
conservation equations are then:
\begin{itemize}
	\item Conservation of energy
		\begin{equation}
			\rho c_p \left( \frac{\partial T}{\partial t} + \u \cdot \nabla
			T\right) = k \nabla^2 T + \rho L \frac{\partial \phi}{\partial t}
			\label{eq:l11:1}
		\end{equation}
		where the final term represents the internal release of latent heat.
	\item Conservation of solute
		\begin{equation}
			(1-\phi)\frac{\partial C}{\partial t} + \u \cdot \nabla C =
			\cancel{\nabla \cdot \left[ D(1-\phi) \nabla C\right]} + C \frac{\partial
			\phi}{\partial t}\label{eq:l11:2}
		\end{equation}
		where the diffusion term is negligible for $D/\kappa \ll 1$. The final
		term represents the internal release of solute.
	\item Conservation of mass
		\begin{equation}
			\nabla \cdot \u = 0 \label{eq:l11:3}
		\end{equation}
	\item Conservation of momentum (Darcy's law)
		\begin{equation}
			\u = -\frac{\Pi}{\mu} \left[ \nabla p - (\rho -
			\rho_0)g\right]\label{eq:l11:4}
		\end{equation}
		where $\Pi$ is now being used for permeability since $k$ is the
		thermal conductivity.
\end{itemize}
To supplement these conservation equations we have the requirement of phase
equilibrium (constrained by the liquidus)
\begin{equation}
	T = T_L(C) = T_L(C_0) - m(C-C_0)\label{eq:l11:5}
\end{equation}
and the equation of state
\begin{equation}
	\rho = \rho_0 \left[ 1 - \alpha(T-T_0) + \beta
	(C-C_0)\right]\label{eq:l11:6}
\end{equation}

\paragraph{Heat capacity for a stagnant mushy layer}
Consider a mushy layer at rest $\u = 0$. Conservation of solute
\eqref{eq:l11:2} gives
\begin{align}
	(1-\phi)\frac{\partial C}{\partial t} &= C\frac{\partial \phi}{\partial t}
	\\
	\implies \frac{\partial}{\partial t}\left[ (1-\phi)C\right] &= 0
\end{align}
Hence $(1-\phi)C = C_0$ is constant. Then the solid fraction is
\begin{equation}
	\phi = 1-\frac{C_0}{C}
\end{equation}
The time derivative of $\phi$ can then be determined as
\begin{equation}
	\frac{\partial \phi}{\partial t} = \frac{C_0}{C^2} \frac{\partial
	C}{\partial t} = -\frac{C_0}{mC^2}\frac{\partial T}{\partial t}
\end{equation}
using \eqref{eq:l11:5}. Substituting into \eqref{eq:l11:1} we have
\begin{align}
	\rho c_p \left[ 1 + \frac{L}{c_p}\frac{C_0}{mC^2}\right] \frac{\partial
	T}{\partial t} &= k\nabla^2 T \\
	\implies \rho c_{p,\text{eff}} \frac{\partial T}{\partial t} = k \nabla^2
	T
\end{align}
where the effective heat capacity is
\begin{equation}
	c_{p,\text{eff}} = c_p \left[ 1 + \frac{L}{c_p} \frac{C_0}{mC^2}\right]
\end{equation}
We now partially non-dimensionalise using scalings $T \sim \Delta T = T_0 -
T_B$ and $C \sim \Delta C = C_B -C_0$. Define the new variable
\begin{equation}
	\theta = \frac{T-T_0}{\Delta T} = \frac{C-C_0}{\Delta C}
\end{equation}
noting $\Delta T = m \Delta C$. We therefore have 
\begin{align}
	\frac{\partial \theta}{\partial t} + \u \cdot \nabla \theta &= \kappa
	\nabla^2 \theta + \S \frac{\partial \phi}{\partial t} \\
	(1-\phi)\frac{\partial \theta}{\partial t} + \u \cdot \nabla \theta &=
	-(\C-\theta)\frac{\partial \phi}{\partial t}
\end{align}
where we can now write $\S = L/c_p \Delta T$ and $\C = C_0/\Delta C$.

For a \emph{stagnant} mushy layer $\u = 0$ we get
\begin{align}
	(1-\phi)\frac{\partial \theta}{\partial t} &= -(\C - \theta)\frac{\partial
	\phi}{\partial t} \\
		\implies \frac{\partial}{\partial t}\left[ (1-\phi)(\C-\theta)\right]
		&= 0 \\
	(1-\phi)(\C-\theta) = \text{const.} &= \C
\end{align}
Hence we can write the solid fraction profile as
\begin{equation}
	\phi = \frac{-\theta}{\C-\theta}
\end{equation}
which is determined in terms of $\theta(x,t)$. For $\C \gg 1, \phi \ll 1$ and
$\phi_t \approx -\frac{1}{\C}\theta_t$. Hence
\begin{equation}
	\left(1+\frac{\S}{\C}\right) \frac{\partial \theta}{\partial t} = \kappa
	\nabla^2 \theta
\end{equation}
The internal release of latent heat results in a modified (non-dimensional)
heat capacity.






\end{document}
